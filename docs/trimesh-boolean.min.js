!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r="undefined"!=typeof globalThis?globalThis:r||self).TrimeshBoolean={})}(this,function(r){"use strict";function t(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return Math.sqrt(e*e+n*n+a*a)}function e(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return e*e+n*n+a*a}function n(r){var t=r.v1.x-r.v0.x,e=r.v1.y-r.v0.y,n=r.v1.z-r.v0.z,a=r.v2.x-r.v0.x,i=r.v2.y-r.v0.y,v=r.v2.z-r.v0.z,o=e*v-n*i,s=n*a-t*v,h=t*i-e*a;return.5*Math.sqrt(o*o+s*s+h*h)}function a(r,t){return{x:r.y*t.z-r.z*t.y,y:r.z*t.x-r.x*t.z,z:r.x*t.y-r.y*t.x}}function i(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}function v(r,t){return r<t?r+"|"+t:t+"|"+r}function o(r){for(var t={},e=0;e<r.length;e++)for(var n=r[e],a=[n.v0,n.v1,n.v2],o=[i(a[0]),i(a[1]),i(a[2])],s=0;s<3;s++){var h=v(o[s],o[(s+1)%3]);t[h]||(t[h]=0),t[h]++}var l=0,f=0,u=0;for(var x in t)u++,1===t[x]?l++:t[x]>2&&f++;return{openEdges:l,overShared:f,total:u}}function s(r){var t=a({x:r.v1.x-r.v0.x,y:r.v1.y-r.v0.y,z:r.v1.z-r.v0.z},{x:r.v2.x-r.v0.x,y:r.v2.y-r.v0.y,z:r.v2.z-r.v0.z}),e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return e<1e-15?{x:0,y:0,z:1}:{x:t.x/e,y:t.y/e,z:t.z/e}}function h(r,t){var e=s(t),n=-(e.x*t.v0.x+e.y*t.v0.y+e.z*t.v0.z),i=e.x*r.v0.x+e.y*r.v0.y+e.z*r.v0.z+n,v=e.x*r.v1.x+e.y*r.v1.y+e.z*r.v1.z+n,o=e.x*r.v2.x+e.y*r.v2.y+e.z*r.v2.z+n;if(i>0&&v>0&&o>0)return null;if(i<0&&v<0&&o<0)return null;var h=s(r),u=-(h.x*r.v0.x+h.y*r.v0.y+h.z*r.v0.z),x=h.x*t.v0.x+h.y*t.v0.y+h.z*t.v0.z+u,y=h.x*t.v1.x+h.y*t.v1.y+h.z*t.v1.z+u,c=h.x*t.v2.x+h.y*t.v2.y+h.z*t.v2.z+u;if(x>0&&y>0&&c>0)return null;if(x<0&&y<0&&c<0)return null;var g=h.x*e.x+h.y*e.y+h.z*e.z;if(Math.abs(g)>.9999)return null;var z=a(h,e),d=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);if(d<1e-12)return null;z.x/=d,z.y/=d,z.z/=d;var p=f(h,u,e,n,z);if(!p)return null;var M=l(r,z,p,i,v,o);if(!M)return null;var m=l(t,z,p,x,y,c);if(!m)return null;var b=Math.max(M.min,m.min),w=Math.min(M.max,m.max);if(b>=w-1e-10)return null;var k={x:p.x+z.x*b,y:p.y+z.y*b,z:p.z+z.z*b},_={x:p.x+z.x*w,y:p.y+z.y*w,z:p.z+z.z*w},F=k.x-_.x,A=k.y-_.y,I=k.z-_.z;return Math.sqrt(F*F+A*A+I*I)<1e-8?null:{p0:k,p1:_}}function l(r,t,e,n,a,i){for(var v=[r.v0,r.v1,r.v2],o=[n,a,i],s=[],h=0;h<3;h++){var l=(h+1)%3,f=o[h],u=o[l];if(f>0&&u<0||f<0&&u>0){var x=f/(f-u),y={x:v[h].x+x*(v[l].x-v[h].x),y:v[h].y+x*(v[l].y-v[h].y),z:v[h].z+x*(v[l].z-v[h].z)},c=(y.x-e.x)*t.x+(y.y-e.y)*t.y+(y.z-e.z)*t.z;s.push(c)}else if(Math.abs(f)<1e-10){var g=(v[h].x-e.x)*t.x+(v[h].y-e.y)*t.y+(v[h].z-e.z)*t.z;s.push(g)}}return s.length<2?null:(s.sort(function(r,t){return r-t}),{min:s[0],max:s[s.length-1]})}function f(r,t,e,n,a){var i,v,o,s=Math.abs(a.x),h=Math.abs(a.y),l=Math.abs(a.z);if(l>=s&&l>=h){var f=r.x*e.y-r.y*e.x;if(Math.abs(f)<1e-12)return null;i=(-t*e.y+n*r.y)/f,v=(r.x*-n-e.x*-t)/f,o=0}else if(h>=s){var u=r.x*e.z-r.z*e.x;if(Math.abs(u)<1e-12)return null;i=(-t*e.z+n*r.z)/u,v=0,o=(r.x*-n-e.x*-t)/u}else{var x=r.y*e.z-r.z*e.y;if(Math.abs(x)<1e-12)return null;i=0,v=(-t*e.z+n*r.z)/x,o=(r.y*-n-e.y*-t)/x}return{x:i,y:v,z:o}}function u(r,t){for(var e={},n=0;n<r.length;n++)for(var a=y(r[n]),i=Math.floor(a.minX/t),v=Math.floor(a.minY/t),o=Math.floor(a.maxX/t),s=Math.floor(a.maxY/t),h=i;h<=o;h++)for(var l=v;l<=s;l++){var f=h+","+l;e[f]||(e[f]=[]),e[f].push(n)}return e}function x(r,t,e){for(var n=Math.floor(t.minX/e),a=Math.floor(t.minY/e),i=Math.floor(t.maxX/e),v=Math.floor(t.maxY/e),o={},s=[],h=n;h<=i;h++)for(var l=a;l<=v;l++){var f=r[h+","+l];if(f)for(var u=0;u<f.length;u++){var x=f[u];o[x]||(o[x]=!0,s.push(x))}}return s}function y(r){return{minX:Math.min(r.v0.x,r.v1.x,r.v2.x),minY:Math.min(r.v0.y,r.v1.y,r.v2.y),minZ:Math.min(r.v0.z,r.v1.z,r.v2.z),maxX:Math.max(r.v0.x,r.v1.x,r.v2.x),maxY:Math.max(r.v0.y,r.v1.y,r.v2.y),maxZ:Math.max(r.v0.z,r.v1.z,r.v2.z)}}function c(r){if(0===r.length)return 1;for(var e=0,n=Math.min(r.length,100),a=0;a<n;a++){var i=r[a];e+=t(i.v0,i.v1),e+=t(i.v1,i.v2),e+=t(i.v2,i.v0)}return e/(3*n)}function g(r,t){for(var e=[],n=c(t),a=Math.max(2*n,.1),i=u(t,a),v=0;v<r.length;v++)for(var o=r[v],s=x(i,y(o),a),l=0;l<s.length;l++){var f=s[l],g=h(o,t[f]);g&&e.push({p0:g.p0,p1:g.p1,idxA:v,idxB:f})}return e}const z=11102230246251565e-32,d=134217729,p=(3+8*z)*z;function M(r,t,e,n,a){let i,v,o,s,h=t[0],l=n[0],f=0,u=0;l>h==l>-h?(i=h,h=t[++f]):(i=l,l=n[++u]);let x=0;if(f<r&&u<e)for(l>h==l>-h?(v=h+i,o=i-(v-h),h=t[++f]):(v=l+i,o=i-(v-l),l=n[++u]),i=v,0!==o&&(a[x++]=o);f<r&&u<e;)l>h==l>-h?(v=i+h,s=v-i,o=i-(v-s)+(h-s),h=t[++f]):(v=i+l,s=v-i,o=i-(v-s)+(l-s),l=n[++u]),i=v,0!==o&&(a[x++]=o);for(;f<r;)v=i+h,s=v-i,o=i-(v-s)+(h-s),h=t[++f],i=v,0!==o&&(a[x++]=o);for(;u<e;)v=i+l,s=v-i,o=i-(v-s)+(l-s),l=n[++u],i=v,0!==o&&(a[x++]=o);return 0===i&&0!==x||(a[x++]=i),x}function m(r,t,e,n,a,i,v,o){return M(M(r,t,e,n,v),v,a,i,o)}function b(r,t,e,n){let a,i,v,o,s,h,l,f,u,x,y;l=d*e,x=l-(l-e),y=e-x;let c=t[0];a=c*e,l=d*c,f=l-(l-c),u=c-f,v=u*y-(a-f*x-u*x-f*y);let g=0;0!==v&&(n[g++]=v);for(let z=1;z<r;z++)c=t[z],o=c*e,l=d*c,f=l-(l-c),u=c-f,s=u*y-(o-f*x-u*x-f*y),i=a+s,h=i-a,v=a-(i-h)+(s-h),0!==v&&(n[g++]=v),a=o+i,v=i-(a-o),0!==v&&(n[g++]=v);return 0===a&&0!==g||(n[g++]=a),g}function w(r,t){let e=t[0];for(let n=1;n<r;n++)e+=t[n];return e}function k(r){return new Float64Array(r)}const _=k(4),F=k(8),A=k(12),I=k(16),S=k(4);function E(r,t,e,n,a,i){const v=(t-i)*(e-a),o=(r-a)*(n-i),s=v-o,h=Math.abs(v+o);return Math.abs(s)>=33306690738754716e-32*h?s:-function(r,t,e,n,a,i,v){let o,s,h,l,f,u,x,y,c,g,z,m,b,k,E,T,q,C;const X=r-a,Y=e-a,D=t-i,B=n-i;k=X*B,u=d*X,x=u-(u-X),y=X-x,u=d*B,c=u-(u-B),g=B-c,E=y*g-(k-x*c-y*c-x*g),T=D*Y,u=d*D,x=u-(u-D),y=D-x,u=d*Y,c=u-(u-Y),g=Y-c,q=y*g-(T-x*c-y*c-x*g),z=E-q,f=E-z,_[0]=E-(z+f)+(f-q),m=k+z,f=m-k,b=k-(m-f)+(z-f),z=b-T,f=b-z,_[1]=b-(z+f)+(f-T),C=m+z,f=C-m,_[2]=m-(C-f)+(z-f),_[3]=C;let U=w(4,_),Z=22204460492503146e-32*v;if(U>=Z||-U>=Z)return U;if(f=r-X,o=r-(X+f)+(f-a),f=e-Y,h=e-(Y+f)+(f-a),f=t-D,s=t-(D+f)+(f-i),f=n-B,l=n-(B+f)+(f-i),0===o&&0===s&&0===h&&0===l)return U;if(Z=11093356479670487e-47*v+p*Math.abs(U),U+=X*l+B*o-(D*h+Y*s),U>=Z||-U>=Z)return U;k=o*B,u=d*o,x=u-(u-o),y=o-x,u=d*B,c=u-(u-B),g=B-c,E=y*g-(k-x*c-y*c-x*g),T=s*Y,u=d*s,x=u-(u-s),y=s-x,u=d*Y,c=u-(u-Y),g=Y-c,q=y*g-(T-x*c-y*c-x*g),z=E-q,f=E-z,S[0]=E-(z+f)+(f-q),m=k+z,f=m-k,b=k-(m-f)+(z-f),z=b-T,f=b-z,S[1]=b-(z+f)+(f-T),C=m+z,f=C-m,S[2]=m-(C-f)+(z-f),S[3]=C;const O=M(4,_,4,S,F);k=X*l,u=d*X,x=u-(u-X),y=X-x,u=d*l,c=u-(u-l),g=l-c,E=y*g-(k-x*c-y*c-x*g),T=D*h,u=d*D,x=u-(u-D),y=D-x,u=d*h,c=u-(u-h),g=h-c,q=y*g-(T-x*c-y*c-x*g),z=E-q,f=E-z,S[0]=E-(z+f)+(f-q),m=k+z,f=m-k,b=k-(m-f)+(z-f),z=b-T,f=b-z,S[1]=b-(z+f)+(f-T),C=m+z,f=C-m,S[2]=m-(C-f)+(z-f),S[3]=C;const V=M(O,F,4,S,A);k=o*l,u=d*o,x=u-(u-o),y=o-x,u=d*l,c=u-(u-l),g=l-c,E=y*g-(k-x*c-y*c-x*g),T=s*h,u=d*s,x=u-(u-s),y=s-x,u=d*h,c=u-(u-h),g=h-c,q=y*g-(T-x*c-y*c-x*g),z=E-q,f=E-z,S[0]=E-(z+f)+(f-q),m=k+z,f=m-k,b=k-(m-f)+(z-f),z=b-T,f=b-z,S[1]=b-(z+f)+(f-T),C=m+z,f=C-m,S[2]=m-(C-f)+(z-f),S[3]=C;const P=M(V,A,4,S,I);return I[P-1]}(r,t,e,n,a,i,h)}const T=k(4),q=k(4),C=k(4),X=k(4),Y=k(4),D=k(4),B=k(4),U=k(4),Z=k(8),O=k(8),V=k(8),P=k(8),j=k(8),L=k(8),K=k(8),N=k(8),W=k(8),R=k(4),G=k(4),H=k(4),J=k(8),Q=k(16),$=k(16),rr=k(16),tr=k(32),er=k(32),nr=k(48),ar=k(64);let ir=k(1152),vr=k(1152);function or(r,t,e){r=M(r,ir,t,e,vr);const n=ir;return ir=vr,vr=n,r}function sr(r,t,e,n,a,i,v,o){const s=r-v,h=e-v,l=a-v,f=t-o,u=n-o,x=i-o,y=h*x,c=l*u,g=s*s+f*f,z=l*f,k=s*x,_=h*h+u*u,F=s*u,A=h*f,I=l*l+x*x,S=g*(y-c)+_*(z-k)+I*(F-A),E=(Math.abs(y)+Math.abs(c))*g+(Math.abs(z)+Math.abs(k))*_+(Math.abs(F)+Math.abs(A))*I,vr=11102230246251577e-31*E;return S>vr||-S>vr?S:function(r,t,e,n,a,i,v,o,s){let h,l,f,u,x,y,c,g,z,k,_,F,A,I,S,E,vr,sr,hr,lr,fr,ur,xr,yr,cr,gr,zr,dr,pr,Mr,mr,br,wr,kr,_r;const Fr=r-v,Ar=e-v,Ir=a-v,Sr=t-o,Er=n-o,Tr=i-o;mr=Ar*Tr,xr=d*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=d*Tr,gr=xr-(xr-Tr),zr=Tr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ir*Er,xr=d*Ir,yr=xr-(xr-Ir),cr=Ir-yr,xr=d*Er,gr=xr-(xr-Er),zr=Er-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,T[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,T[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,T[2]=pr-(_r-ur)+(dr-ur),T[3]=_r,mr=Ir*Sr,xr=d*Ir,yr=xr-(xr-Ir),cr=Ir-yr,xr=d*Sr,gr=xr-(xr-Sr),zr=Sr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Fr*Tr,xr=d*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=d*Tr,gr=xr-(xr-Tr),zr=Tr-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,q[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,q[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,q[2]=pr-(_r-ur)+(dr-ur),q[3]=_r,mr=Fr*Er,xr=d*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=d*Er,gr=xr-(xr-Er),zr=Er-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ar*Sr,xr=d*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=d*Sr,gr=xr-(xr-Sr),zr=Sr-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,C[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,C[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,C[2]=pr-(_r-ur)+(dr-ur),C[3]=_r,h=M(M(M(b(b(4,T,Fr,J),J,Fr,Q),Q,b(b(4,T,Sr,J),J,Sr,$),$,tr),tr,M(b(b(4,q,Ar,J),J,Ar,Q),Q,b(b(4,q,Er,J),J,Er,$),$,er),er,ar),ar,M(b(b(4,C,Ir,J),J,Ir,Q),Q,b(b(4,C,Tr,J),J,Tr,$),$,tr),tr,ir);let qr=w(h,ir),Cr=4440892098500632e-31*s;if(qr>=Cr||-qr>=Cr)return qr;if(ur=r-Fr,l=r-(Fr+ur)+(ur-v),ur=t-Sr,x=t-(Sr+ur)+(ur-o),ur=e-Ar,f=e-(Ar+ur)+(ur-v),ur=n-Er,y=n-(Er+ur)+(ur-o),ur=a-Ir,u=a-(Ir+ur)+(ur-v),ur=i-Tr,c=i-(Tr+ur)+(ur-o),0===l&&0===f&&0===u&&0===x&&0===y&&0===c)return qr;if(Cr=5423418723394464e-46*s+p*Math.abs(qr),qr+=(Fr*Fr+Sr*Sr)*(Ar*c+Tr*f-(Er*u+Ir*y))+2*(Fr*l+Sr*x)*(Ar*Tr-Er*Ir)+((Ar*Ar+Er*Er)*(Ir*x+Sr*u-(Tr*l+Fr*c))+2*(Ar*f+Er*y)*(Ir*Sr-Tr*Fr))+((Ir*Ir+Tr*Tr)*(Fr*y+Er*l-(Sr*f+Ar*x))+2*(Ir*u+Tr*c)*(Fr*Er-Sr*Ar)),qr>=Cr||-qr>=Cr)return qr;if(0===f&&0===y&&0===u&&0===c||(mr=Fr*Fr,xr=d*Fr,yr=xr-(xr-Fr),cr=Fr-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Sr*Sr,xr=d*Sr,yr=xr-(xr-Sr),cr=Sr-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,X[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,X[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,X[2]=pr-(_r-ur)+(dr-ur),X[3]=_r),0===u&&0===c&&0===l&&0===x||(mr=Ar*Ar,xr=d*Ar,yr=xr-(xr-Ar),cr=Ar-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Er*Er,xr=d*Er,yr=xr-(xr-Er),cr=Er-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,Y[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,Y[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,Y[2]=pr-(_r-ur)+(dr-ur),Y[3]=_r),0===l&&0===x&&0===f&&0===y||(mr=Ir*Ir,xr=d*Ir,yr=xr-(xr-Ir),cr=Ir-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Tr*Tr,xr=d*Tr,yr=xr-(xr-Tr),cr=Tr-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,D[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,D[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,D[2]=pr-(_r-ur)+(dr-ur),D[3]=_r),0!==l&&(g=b(4,T,l,Z),h=or(h,m(b(g,Z,2*Fr,Q),Q,b(b(4,D,l,J),J,Er,$),$,b(b(4,Y,l,J),J,-Tr,rr),rr,tr,nr),nr)),0!==x&&(z=b(4,T,x,O),h=or(h,m(b(z,O,2*Sr,Q),Q,b(b(4,Y,x,J),J,Ir,$),$,b(b(4,D,x,J),J,-Ar,rr),rr,tr,nr),nr)),0!==f&&(k=b(4,q,f,V),h=or(h,m(b(k,V,2*Ar,Q),Q,b(b(4,X,f,J),J,Tr,$),$,b(b(4,D,f,J),J,-Sr,rr),rr,tr,nr),nr)),0!==y&&(_=b(4,q,y,P),h=or(h,m(b(_,P,2*Er,Q),Q,b(b(4,D,y,J),J,Fr,$),$,b(b(4,X,y,J),J,-Ir,rr),rr,tr,nr),nr)),0!==u&&(F=b(4,C,u,j),h=or(h,m(b(F,j,2*Ir,Q),Q,b(b(4,Y,u,J),J,Sr,$),$,b(b(4,X,u,J),J,-Er,rr),rr,tr,nr),nr)),0!==c&&(A=b(4,C,c,L),h=or(h,m(b(A,L,2*Tr,Q),Q,b(b(4,X,c,J),J,Ar,$),$,b(b(4,Y,c,J),J,-Fr,rr),rr,tr,nr),nr)),0!==l||0!==x){if(0!==f||0!==y||0!==u||0!==c?(mr=f*Tr,xr=d*f,yr=xr-(xr-f),cr=f-yr,xr=d*Tr,gr=xr-(xr-Tr),zr=Tr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ar*c,xr=d*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=d*c,gr=xr-(xr-c),zr=c-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,B[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,B[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,B[2]=pr-(_r-ur)+(dr-ur),B[3]=_r,mr=u*-Er,xr=d*u,yr=xr-(xr-u),cr=u-yr,xr=d*-Er,gr=xr-(xr- -Er),zr=-Er-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ir*-y,xr=d*Ir,yr=xr-(xr-Ir),cr=Ir-yr,xr=d*-y,gr=xr-(xr- -y),zr=-y-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,S=M(4,B,4,U,N),mr=f*c,xr=d*f,yr=xr-(xr-f),cr=f-yr,xr=d*c,gr=xr-(xr-c),zr=c-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=u*y,xr=d*u,yr=xr-(xr-u),cr=u-yr,xr=d*y,gr=xr-(xr-y),zr=y-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,G[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,G[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,G[2]=pr-(_r-ur)+(dr-ur),G[3]=_r,sr=4):(N[0]=0,S=1,G[0]=0,sr=1),0!==l){const r=b(S,N,l,rr);h=or(h,M(b(g,Z,l,Q),Q,b(r,rr,2*Fr,tr),tr,nr),nr);const t=b(sr,G,l,J);h=or(h,m(b(t,J,2*Fr,Q),Q,b(t,J,l,$),$,b(r,rr,l,tr),tr,er,ar),ar),0!==y&&(h=or(h,b(b(4,D,l,J),J,y,Q),Q)),0!==c&&(h=or(h,b(b(4,Y,-l,J),J,c,Q),Q))}if(0!==x){const r=b(S,N,x,rr);h=or(h,M(b(z,O,x,Q),Q,b(r,rr,2*Sr,tr),tr,nr),nr);const t=b(sr,G,x,J);h=or(h,m(b(t,J,2*Sr,Q),Q,b(t,J,x,$),$,b(r,rr,x,tr),tr,er,ar),ar)}}if(0!==f||0!==y){if(0!==u||0!==c||0!==l||0!==x?(mr=u*Sr,xr=d*u,yr=xr-(xr-u),cr=u-yr,xr=d*Sr,gr=xr-(xr-Sr),zr=Sr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ir*x,xr=d*Ir,yr=xr-(xr-Ir),cr=Ir-yr,xr=d*x,gr=xr-(xr-x),zr=x-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,B[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,B[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,B[2]=pr-(_r-ur)+(dr-ur),B[3]=_r,lr=-Tr,fr=-c,mr=l*lr,xr=d*l,yr=xr-(xr-l),cr=l-yr,xr=d*lr,gr=xr-(xr-lr),zr=lr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Fr*fr,xr=d*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=d*fr,gr=xr-(xr-fr),zr=fr-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,E=M(4,B,4,U,W),mr=u*x,xr=d*u,yr=xr-(xr-u),cr=u-yr,xr=d*x,gr=xr-(xr-x),zr=x-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=l*c,xr=d*l,yr=xr-(xr-l),cr=l-yr,xr=d*c,gr=xr-(xr-c),zr=c-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,H[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,H[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,H[2]=pr-(_r-ur)+(dr-ur),H[3]=_r,hr=4):(W[0]=0,E=1,H[0]=0,hr=1),0!==f){const r=b(E,W,f,rr);h=or(h,M(b(k,V,f,Q),Q,b(r,rr,2*Ar,tr),tr,nr),nr);const t=b(hr,H,f,J);h=or(h,m(b(t,J,2*Ar,Q),Q,b(t,J,f,$),$,b(r,rr,f,tr),tr,er,ar),ar),0!==c&&(h=or(h,b(b(4,X,f,J),J,c,Q),Q)),0!==x&&(h=or(h,b(b(4,D,-f,J),J,x,Q),Q))}if(0!==y){const r=b(E,W,y,rr);h=or(h,M(b(_,P,y,Q),Q,b(r,rr,2*Er,tr),tr,nr),nr);const t=b(hr,H,y,J);h=or(h,m(b(t,J,2*Er,Q),Q,b(t,J,y,$),$,b(r,rr,y,tr),tr,er,ar),ar)}}if(0!==u||0!==c){if(0!==l||0!==x||0!==f||0!==y?(mr=l*Er,xr=d*l,yr=xr-(xr-l),cr=l-yr,xr=d*Er,gr=xr-(xr-Er),zr=Er-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Fr*y,xr=d*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=d*y,gr=xr-(xr-y),zr=y-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,B[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,B[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,B[2]=pr-(_r-ur)+(dr-ur),B[3]=_r,lr=-Sr,fr=-x,mr=f*lr,xr=d*f,yr=xr-(xr-f),cr=f-yr,xr=d*lr,gr=xr-(xr-lr),zr=lr-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=Ar*fr,xr=d*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=d*fr,gr=xr-(xr-fr),zr=fr-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,I=M(4,B,4,U,K),mr=l*y,xr=d*l,yr=xr-(xr-l),cr=l-yr,xr=d*y,gr=xr-(xr-y),zr=y-gr,br=cr*zr-(mr-yr*gr-cr*gr-yr*zr),wr=f*x,xr=d*f,yr=xr-(xr-f),cr=f-yr,xr=d*x,gr=xr-(xr-x),zr=x-gr,kr=cr*zr-(wr-yr*gr-cr*gr-yr*zr),dr=br-kr,ur=br-dr,R[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,R[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,R[2]=pr-(_r-ur)+(dr-ur),R[3]=_r,vr=4):(K[0]=0,I=1,R[0]=0,vr=1),0!==u){const r=b(I,K,u,rr);h=or(h,M(b(F,j,u,Q),Q,b(r,rr,2*Ir,tr),tr,nr),nr);const t=b(vr,R,u,J);h=or(h,m(b(t,J,2*Ir,Q),Q,b(t,J,u,$),$,b(r,rr,u,tr),tr,er,ar),ar),0!==x&&(h=or(h,b(b(4,Y,u,J),J,x,Q),Q)),0!==y&&(h=or(h,b(b(4,X,-u,J),J,y,Q),Q))}if(0!==c){const r=b(I,K,c,rr);h=or(h,M(b(A,L,c,Q),Q,b(r,rr,2*Tr,tr),tr,nr),nr);const t=b(vr,R,c,J);h=or(h,m(b(t,J,2*Tr,Q),Q,b(t,J,c,$),$,b(r,rr,c,tr),tr,er,ar),ar)}}return ir[h-1]}(r,t,e,n,a,i,v,o,E)}const hr=Math.pow(2,-52),lr=new Uint32Array(512);class fr{static from(r,t=zr,e=dr){const n=r.length,a=new Float64Array(2*n);for(let i=0;i<n;i++){const n=r[i];a[2*i]=t(n),a[2*i+1]=e(n)}return new fr(a)}constructor(r){const t=r.length>>1;if(t>0&&"number"!=typeof r[0])throw new Error("Expected coords to contain numbers.");this.coords=r;const e=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*e),this._halfedges=new Int32Array(3*e),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:r,_hullPrev:t,_hullNext:e,_hullTri:n,_hullHash:a}=this,i=r.length>>1;let v=1/0,o=1/0,s=-1/0,h=-1/0;for(let t=0;t<i;t++){const e=r[2*t],n=r[2*t+1];e<v&&(v=e),n<o&&(o=n),e>s&&(s=e),n>h&&(h=n),this._ids[t]=t}const l=(v+s)/2,f=(o+h)/2;let u,x,y;for(let t=0,e=1/0;t<i;t++){const n=ur(l,f,r[2*t],r[2*t+1]);n<e&&(u=t,e=n)}const c=r[2*u],g=r[2*u+1];for(let t=0,e=1/0;t<i;t++){if(t===u)continue;const n=ur(c,g,r[2*t],r[2*t+1]);n<e&&n>0&&(x=t,e=n)}let z=r[2*x],d=r[2*x+1],p=1/0;for(let t=0;t<i;t++){if(t===u||t===x)continue;const e=yr(c,g,z,d,r[2*t],r[2*t+1]);e<p&&(y=t,p=e)}let M=r[2*y],m=r[2*y+1];if(p===1/0){for(let t=0;t<i;t++)this._dists[t]=r[2*t]-r[0]||r[2*t+1]-r[1];cr(this._ids,this._dists,0,i-1);const t=new Uint32Array(i);let e=0;for(let r=0,n=-1/0;r<i;r++){const a=this._ids[r],i=this._dists[a];i>n&&(t[e++]=a,n=i)}return this.hull=t.subarray(0,e),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(E(c,g,z,d,M,m)<0){const r=x,t=z,e=d;x=y,z=M,d=m,y=r,M=t,m=e}const b=function(r,t,e,n,a,i){const v=e-r,o=n-t,s=a-r,h=i-t,l=v*v+o*o,f=s*s+h*h,u=.5/(v*h-o*s);return{x:r+(h*l-o*f)*u,y:t+(v*f-s*l)*u}}(c,g,z,d,M,m);this._cx=b.x,this._cy=b.y;for(let t=0;t<i;t++)this._dists[t]=ur(r[2*t],r[2*t+1],b.x,b.y);cr(this._ids,this._dists,0,i-1),this._hullStart=u;let w=3;e[u]=t[y]=x,e[x]=t[u]=y,e[y]=t[x]=u,n[u]=0,n[x]=1,n[y]=2,a.fill(-1),a[this._hashKey(c,g)]=u,a[this._hashKey(z,d)]=x,a[this._hashKey(M,m)]=y,this.trianglesLen=0,this._addTriangle(u,x,y,-1,-1,-1);for(let i,v,o=0;o<this._ids.length;o++){const s=this._ids[o],h=r[2*s],l=r[2*s+1];if(o>0&&Math.abs(h-i)<=hr&&Math.abs(l-v)<=hr)continue;if(i=h,v=l,s===u||s===x||s===y)continue;let f=0;for(let r=0,t=this._hashKey(h,l);r<this._hashSize&&(f=a[(t+r)%this._hashSize],-1===f||f===e[f]);r++);f=t[f];let c,g=f;for(;c=e[g],E(h,l,r[2*g],r[2*g+1],r[2*c],r[2*c+1])>=0;)if(g=c,g===f){g=-1;break}if(-1===g)continue;let z=this._addTriangle(g,s,e[g],-1,-1,n[g]);n[s]=this._legalize(z+2),n[g]=z,w++;let d=e[g];for(;c=e[d],E(h,l,r[2*d],r[2*d+1],r[2*c],r[2*c+1])<0;)z=this._addTriangle(d,s,c,n[s],-1,n[d]),n[s]=this._legalize(z+2),e[d]=d,w--,d=c;if(g===f)for(;c=t[g],E(h,l,r[2*c],r[2*c+1],r[2*g],r[2*g+1])<0;)z=this._addTriangle(c,s,g,-1,n[g],n[c]),this._legalize(z+2),n[c]=z,e[g]=g,w--,g=c;this._hullStart=t[s]=g,e[g]=t[d]=s,e[s]=d,a[this._hashKey(h,l)]=s,a[this._hashKey(r[2*g],r[2*g+1])]=g}this.hull=new Uint32Array(w);for(let r=0,t=this._hullStart;r<w;r++)this.hull[r]=t,t=e[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(r,t){return Math.floor(function(r,t){const e=r/(Math.abs(r)+Math.abs(t));return(t>0?3-e:1+e)/4}(r-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(r){const{_triangles:t,_halfedges:e,coords:n}=this;let a=0,i=0;for(;;){const v=e[r],o=r-r%3;if(i=o+(r+2)%3,-1===v){if(0===a)break;r=lr[--a];continue}const s=v-v%3,h=o+(r+1)%3,l=s+(v+2)%3,f=t[i],u=t[r],x=t[h],y=t[l];if(xr(n[2*f],n[2*f+1],n[2*u],n[2*u+1],n[2*x],n[2*x+1],n[2*y],n[2*y+1])){t[r]=y,t[v]=f;const n=e[l];if(-1===n){let t=this._hullStart;do{if(this._hullTri[t]===l){this._hullTri[t]=r;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(r,n),this._link(v,e[i]),this._link(i,l);const o=s+(v+1)%3;a<lr.length&&(lr[a++]=o)}else{if(0===a)break;r=lr[--a]}}return i}_link(r,t){this._halfedges[r]=t,-1!==t&&(this._halfedges[t]=r)}_addTriangle(r,t,e,n,a,i){const v=this.trianglesLen;return this._triangles[v]=r,this._triangles[v+1]=t,this._triangles[v+2]=e,this._link(v,n),this._link(v+1,a),this._link(v+2,i),this.trianglesLen+=3,v}}function ur(r,t,e,n){const a=r-e,i=t-n;return a*a+i*i}function xr(r,t,e,n,a,i,v,o){const s=r-v,h=t-o,l=e-v,f=n-o,u=a-v,x=i-o,y=l*l+f*f,c=u*u+x*x;return s*(f*c-y*x)-h*(l*c-y*u)+(s*s+h*h)*(l*x-f*u)<0}function yr(r,t,e,n,a,i){const v=e-r,o=n-t,s=a-r,h=i-t,l=v*v+o*o,f=s*s+h*h,u=.5/(v*h-o*s),x=(h*l-o*f)*u,y=(v*f-s*l)*u;return x*x+y*y}function cr(r,t,e,n){if(n-e<=20)for(let a=e+1;a<=n;a++){const n=r[a],i=t[n];let v=a-1;for(;v>=e&&t[r[v]]>i;)r[v+1]=r[v--];r[v+1]=n}else{let a=e+1,i=n;gr(r,e+n>>1,a),t[r[e]]>t[r[n]]&&gr(r,e,n),t[r[a]]>t[r[n]]&&gr(r,a,n),t[r[e]]>t[r[a]]&&gr(r,e,a);const v=r[a],o=t[v];for(;;){do{a++}while(t[r[a]]<o);do{i--}while(t[r[i]]>o);if(i<a)break;gr(r,a,i)}r[e+1]=r[i],r[i]=v,n-a+1>=i-e?(cr(r,t,a,n),cr(r,t,e,i-1)):(cr(r,t,e,i-1),cr(r,t,a,n))}}function gr(r,t,e){const n=r[t];r[t]=r[e],r[e]=n}function zr(r){return r[0]}function dr(r){return r[1]}class pr{constructor(r,t){this.W=r,this.bs=t}add(r){const t=this.W,e=r/t|0,n=r%t;return this.bs[e]|=1<<n,this}delete(r){const t=this.W,e=r/t|0,n=r%t;return this.bs[e]&=~(1<<n),this}set(r,t){const e=this.W,n=r/e|0,a=1<<r%e;return this.bs[n]^=(-t^this.bs[n])&a,t}has(r){const t=this.W,e=r/t|0,n=r%t;return!!(this.bs[e]&1<<n)}forEach(r){const t=this.W,e=this.bs,n=e.length;for(let a=0;a<n;a++){let n=0;for(;e[a]&&n<t;)e[a]&1<<n&&r(a*t+n),n++}return this}}class Mr extends pr{constructor(r){super(8,new Uint8Array(Math.ceil(r/8)).fill(0))}}function mr(r){return r%3==2?r-2:r+1}function br(r){return r%3==0?r+2:r-1}class wr{constructor(r,t){if(!(r&&"object"==typeof r&&r.triangles&&r.halfedges&&r.coords))throw new Error("Expected an object with Delaunator output");if(r.triangles.length%3||r.halfedges.length!==r.triangles.length||r.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(r.triangles.length<3)throw new Error("No edges in triangulation");this.del=r;const e=2**32-1,n=r.coords.length>>1,a=r.triangles.length;this.vertMap=new Uint32Array(n).fill(e),this.flips=new Mr(a),this.consd=new Mr(a);for(let t=0;t<a;t++){const n=r.triangles[t];this.vertMap[n]===e&&this.updateVert(t)}t&&this.constrainAll(t)}constrainOne(r,t){const{triangles:e,halfedges:n}=this.del,a=this.vertMap,i=this.consd,v=a[r];let o=v;do{const a=e[o],i=mr(o);if(a===t)return this.protect(o);const v=br(o),s=e[v];if(s===t)return this.protect(i),i;if(this.intersectSegments(r,t,s,a)){o=v;break}o=n[i]}while(-1!==o&&o!==v);let s=o,h=-1;for(;-1!==o;){const a=n[o],v=br(o),l=br(a),f=mr(a);if(-1===a)throw new Error("Constraining edge exited the hull");if(i.has(o))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(r,t,e[o])||this.isCollinear(r,t,e[a]))throw new Error("Constraining edge intersects point");if(this.intersectSegments(e[o],e[a],e[v],e[l])){if(this.flipDiagonal(o),this.intersectSegments(r,t,e[v],e[l])&&(-1===h&&(h=v),h===v))throw new Error("Infinite loop: flipped diagonal still intersects");e[l]===t?(s=l,o=h,h=-1):this.intersectSegments(r,t,e[f],e[l])&&(o=f)}else{if(-1===h&&(h=o),e[l]===t){if(o===h)throw new Error("Infinite loop: non-convex quadrilateral");o=h,h=-1;continue}if(this.intersectSegments(r,t,e[l],e[a]))o=l;else if(this.intersectSegments(r,t,e[f],e[l]))o=f;else if(h===o)throw new Error("Infinite loop: no further intersect after non-convex")}}const l=this.flips;this.protect(s);do{var f=0;l.forEach(r=>{l.delete(r);const t=n[r];-1!==t&&(l.delete(t),this.isDelaunay(r)||(this.flipDiagonal(r),f++))})}while(f>0);return this.findEdge(r,t)}delaunify(r=!1){const t=this.del.halfedges,e=this.flips,n=this.consd,a=t.length;do{var i=0;for(let r=0;r<a;r++){if(n.has(r))continue;e.delete(r);const a=t[r];-1!==a&&(e.delete(a),this.isDelaunay(r)||(this.flipDiagonal(r),i++))}}while(r&&i>0);return this}constrainAll(r){const t=r.length;for(let e=0;e<t;e++){const t=r[e];this.constrainOne(t[0],t[1])}return this}isConstrained(r){return this.consd.has(r)}findEdge(r,t){const e=this.vertMap[t],{triangles:n,halfedges:a}=this.del;let i=e,v=-1;do{if(n[i]===r)return i;v=mr(i),i=a[v]}while(-1!==i&&i!==e);return n[mr(v)]===r?-v:1/0}protect(r){const t=this.del.halfedges[r],e=this.flips,n=this.consd;return e.delete(r),n.add(r),-1!==t?(e.delete(t),n.add(t),t):-r}markFlip(r){const t=this.del.halfedges,e=this.flips;if(this.consd.has(r))return!1;const n=t[r];return-1!==n&&(e.add(r),e.add(n)),!0}flipDiagonal(r){const{triangles:t,halfedges:e}=this.del,n=this.flips,a=this.consd,i=e[r],v=br(r),o=mr(r),s=br(i),h=mr(i),l=e[v],f=e[s];if(a.has(r))throw new Error("Trying to flip a constrained edge");return t[r]=t[s],e[r]=f,n.set(r,n.has(s))||a.set(r,a.has(s)),-1!==f&&(e[f]=r),e[v]=s,t[i]=t[v],e[i]=l,n.set(i,n.has(v))||a.set(i,a.has(v)),-1!==l&&(e[l]=i),e[s]=v,this.markFlip(r),this.markFlip(o),this.markFlip(i),this.markFlip(h),n.add(v),a.delete(v),n.add(s),a.delete(s),this.updateVert(r),this.updateVert(o),this.updateVert(i),this.updateVert(h),v}isDelaunay(r){const{triangles:t,halfedges:e}=this.del,n=e[r];if(-1===n)return!0;const a=t[br(r)],i=t[r],v=t[mr(r)],o=t[br(n)];return!this.inCircle(a,i,v,o)}updateVert(r){const{triangles:t,halfedges:e}=this.del,n=this.vertMap,a=t[r];let i=br(r),v=e[i];for(;-1!==v&&v!==r;)i=br(v),v=e[i];return n[a]=i,i}intersectSegments(r,t,e,n){const a=this.del.coords;return r!==e&&r!==n&&t!==e&&t!==n&&kr(a[2*r],a[2*r+1],a[2*t],a[2*t+1],a[2*e],a[2*e+1],a[2*n],a[2*n+1])}inCircle(r,t,e,n){const a=this.del.coords;return sr(a[2*r],a[2*r+1],a[2*t],a[2*t+1],a[2*e],a[2*e+1],a[2*n],a[2*n+1])<0}isCollinear(r,t,e){const n=this.del.coords;return 0===E(n[2*r],n[2*r+1],n[2*t],n[2*t+1],n[2*e],n[2*e+1])}}function kr(r,t,e,n,a,i,v,o){const s=E(r,t,a,i,v,o),h=E(e,n,a,i,v,o);if(s>0&&h>0||s<0&&h<0)return!1;const l=E(a,i,r,t,e,n),f=E(v,o,r,t,e,n);return!(l>0&&f>0||l<0&&f<0)&&(0!==s||0!==h||0!==l||0!==f||!(Math.max(a,v)<Math.min(r,e)||Math.max(r,e)<Math.min(a,v)||Math.max(i,o)<Math.min(t,n)||Math.max(t,n)<Math.min(i,o)))}function _r(r,t){if(!t||0===t.length)return[r];var e=r.v1.x-r.v0.x,n=r.v1.y-r.v0.y,a=r.v1.z-r.v0.z,i=r.v2.x-r.v0.x,v=r.v2.y-r.v0.y,o=r.v2.z-r.v0.z,s=Math.sqrt(e*e+n*n+a*a);if(s<1e-12)return[r];var h=e/s,l=n/s,f=a/s,u=n*o-a*v,x=a*i-e*o,y=e*v-n*i;if(Math.sqrt(u*u+x*x+y*y)<1e-12)return[r];var c=x*f-y*l,g=y*h-u*f,z=u*l-x*h,d=Math.sqrt(c*c+g*g+z*z);if(d<1e-12)return[r];c/=d,g/=d,z/=d;var p=r.v0.x,M=r.v0.y,m=r.v0.z;function b(r){var t=r.x-p,e=r.y-M,n=r.z-m;return[t*h+e*l+n*f,t*c+e*g+n*z]}var w=b(r.v0),k=b(r.v1),_=b(r.v2),F=(k[1]-_[1])*(w[0]-_[0])+(_[0]-k[0])*(w[1]-_[1]);if(Math.abs(F)<1e-12)return[r];function A(r,t){var e=((k[1]-_[1])*(r-_[0])+(_[0]-k[0])*(t-_[1]))/F,n=((_[1]-w[1])*(r-_[0])+(w[0]-_[0])*(t-_[1]))/F;return[e,n,1-e-n]}var I=.5*Math.abs(F),S={},E=r.v0.x.toFixed(6)+","+r.v0.y.toFixed(6)+","+r.v0.z.toFixed(6),T=r.v1.x.toFixed(6)+","+r.v1.y.toFixed(6)+","+r.v1.z.toFixed(6),q=r.v2.x.toFixed(6)+","+r.v2.y.toFixed(6)+","+r.v2.z.toFixed(6);S[E]=!0,S[T]=!0,S[q]=!0;var C=-1e-4,X=[],Y={};Y[E]=0,Y[T]=1,Y[q]=2;for(var D=0;D<t.length;D++)for(var B=t[D],U=[B.p0,B.p1],Z=0;Z<2;Z++){var O=U[Z],V=O.x.toFixed(6)+","+O.y.toFixed(6)+","+O.z.toFixed(6);if(!S[V]){S[V]=!0;var P=b(O),j=A(P[0],P[1]);j[0]<C||j[1]<C||j[2]<C||X.push({x:O.x,y:O.y,z:O.z,key:V})}}if(0===X.length)return[r];for(var L=[{x:r.v0.x,y:r.v0.y,z:r.v0.z},{x:r.v1.x,y:r.v1.y,z:r.v1.z},{x:r.v2.x,y:r.v2.y,z:r.v2.z}],K=0;K<X.length;K++)Y[X[K].key]=L.length,L.push(X[K]);for(var N,W=L.length,R=new Float64Array(2*W),G=0;G<W;G++){var H=b(L[G]);R[2*G]=H[0],R[2*G+1]=H[1]}try{N=new fr(R)}catch(t){return[r]}try{for(var J=new wr(N),Q=0;Q<t.length;Q++){var $=t[Q],rr=$.p0.x.toFixed(6)+","+$.p0.y.toFixed(6)+","+$.p0.z.toFixed(6),tr=$.p1.x.toFixed(6)+","+$.p1.y.toFixed(6)+","+$.p1.z.toFixed(6),er=Y[rr],nr=Y[tr];if(void 0!==er&&void 0!==nr&&er!==nr)try{J.constrainOne(er,nr)}catch(r){}}}catch(r){}for(var ar=[],ir=N.triangles,vr=0;vr<ir.length;vr+=3){var or=ir[vr],sr=ir[vr+1],hr=ir[vr+2],lr=A((R[2*or]+R[2*sr]+R[2*hr])/3,(R[2*or+1]+R[2*sr+1]+R[2*hr+1])/3);if(!(lr[0]<-1e-6||lr[1]<-1e-6||lr[2]<-1e-6)){var ur=R[2*or],xr=R[2*or+1],yr=R[2*sr],cr=R[2*sr+1],gr=R[2*hr],zr=R[2*hr+1];.5*Math.abs((yr-ur)*(zr-xr)-(gr-ur)*(cr-xr))<1e-8*I||ar.push({v0:L[or],v1:L[sr],v2:L[hr]})}}return 0===ar.length?[r]:ar}function Fr(r,t,e,n){for(var a=r.x,i=r.y,v=r.z,o=x(e,{minX:a,maxX:a,minY:i,maxY:i},n),s=0,h=0;h<o.length;h++){var l=t[o[h]],f=l.v0.x,u=l.v0.y,y=l.v1.x,c=l.v1.y,g=l.v2.x,z=l.v2.y,d=(c-z)*(f-g)+(g-y)*(u-z);if(!(Math.abs(d)<1e-12)){var p=((c-z)*(a-g)+(g-y)*(i-z))/d,M=((z-u)*(a-g)+(f-g)*(i-z))/d,m=1-p-M;if(!(p<-1e-10||M<-1e-10||m<-1e-10))p*l.v0.z+M*l.v1.z+m*l.v2.z>v&&s++}}return s%2==1?1:-1}function Ar(r,t,e,n,a){var i=r.length,v=new Int8Array(i);function o(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var s={},h=0;h<i;h++)if(!t[h])for(var l=r[h],f=o(l.v0),u=o(l.v1),x=o(l.v2),y=[f<u?f+"|"+u:u+"|"+f,u<x?u+"|"+x:x+"|"+u,x<f?x+"|"+f:f+"|"+x],c=0;c<3;c++)s[y[c]]||(s[y[c]]=[]),s[y[c]].push(h);for(var g=new Array(i),z=0;z<i;z++)g[z]=[];for(var d in s)for(var p=s[d],M=0;M<p.length;M++)for(var m=M+1;m<p.length;m++)g[p[M]].push(p[m]),g[p[m]].push(p[M]);for(var b=new Uint8Array(i),w=0;w<i;w++)if(!b[w]&&!t[w]){var k=r[w],_=Fr({x:(k.v0.x+k.v1.x+k.v2.x)/3,y:(k.v0.y+k.v1.y+k.v2.y)/3,z:(k.v0.z+k.v1.z+k.v2.z)/3},e,n,a),F=[w];b[w]=1,v[w]=_;for(var A=0;A<F.length;)for(var I=g[F[A++]],S=0;S<I.length;S++){var E=I[S];b[E]||(b[E]=1,v[E]=_,F.push(E))}}return v}function Ir(r,t,e,n,a,i){for(var v=[],o=[],s=0;s<r.length;s++)if(e[s])for(var h=e[s],l=_r(r[s],h),f=0;f<l.length;f++){var u=l[f];1===Fr({x:(u.v0.x+u.v1.x+u.v2.x)/3,y:(u.v0.y+u.v1.y+u.v2.y)/3,z:(u.v0.z+u.v1.z+u.v2.z)/3},n,a,i)?v.push(u):o.push(u)}else 1===t[s]?v.push(r[s]):o.push(r[s]);return{inside:v,outside:o}}function Sr(r,t){if(!r||0===r.length)return r;void 0===t&&(t=1e-4);var e=1/(3*t),n={};function a(r,a,i){for(var v=Math.floor(r*e),o=Math.floor(a*e),s=Math.floor(i*e),h=t*t,l=null,f=-1;f<=1;f++)for(var u=-1;u<=1;u++)for(var x=-1;x<=1;x++){var y=n[v+f+","+(o+u)+","+(s+x)];if(y)for(var c=0;c<y.length;c++){var g=y[c],z=g.x-r,d=g.y-a,p=g.z-i,M=z*z+d*d+p*p;M<h&&(h=M,l=g)}}if(l)return l;var m,b,w,k={x:r,y:a,z:i},_=(m=r,b=a,w=i,Math.floor(m*e)+","+Math.floor(b*e)+","+Math.floor(w*e));return n[_]||(n[_]=[]),n[_].push(k),k}for(var i=[],v=0;v<r.length;v++){var o=r[v],s=a(o.v0.x,o.v0.y,o.v0.z),h=a(o.v1.x,o.v1.y,o.v1.z),l=a(o.v2.x,o.v2.y,o.v2.z);s!==h&&h!==l&&l!==s&&i.push({v0:s,v1:h,v2:l})}return i}function Er(r,t){var e=[],n=[];if(t<=0){for(var a=0;a<r.length;a++){var i=r[a];e.push({x:i.v0.x,y:i.v0.y,z:i.v0.z},{x:i.v1.x,y:i.v1.y,z:i.v1.z},{x:i.v2.x,y:i.v2.y,z:i.v2.z}),n.push({vertices:[{x:i.v0.x,y:i.v0.y,z:i.v0.z},{x:i.v1.x,y:i.v1.y,z:i.v1.z},{x:i.v2.x,y:i.v2.y,z:i.v2.z}]})}return{points:e,triangles:n}}var v=Math.max(2*t,.002),o={},s=t*t;function h(r){for(var t=Math.floor(r.x/v),n=Math.floor(r.y/v),a=Math.floor(r.z/v),i=-1;i<=1;i++)for(var h=-1;h<=1;h++)for(var l=-1;l<=1;l++){var f=o[t+i+","+(n+h)+","+(a+l)];if(f)for(var u=0;u<f.length;u++){var x=e[f[u]],y=x.x-r.x,c=x.y-r.y,g=x.z-r.z;if(y*y+c*c+g*g<=s)return f[u]}}var z=e.length;e.push({x:r.x,y:r.y,z:r.z});var d=t+","+n+","+a;return o[d]||(o[d]=[]),o[d].push(z),z}for(var l=0;l<r.length;l++){var f=r[l],u=h(f.v0),x=h(f.v1),y=h(f.v2);u!==x&&x!==y&&u!==y&&n.push({vertices:[{x:e[u].x,y:e[u].y,z:e[u].z},{x:e[x].x,y:e[x].y,z:e[x].z},{x:e[y].x,y:e[y].y,z:e[y].z}]})}return{points:e,triangles:n}}function Tr(r){for(var t=[],e=0;e<r.length;e++){var n=r[e].vertices;t.push({v0:{x:n[0].x,y:n[0].y,z:n[0].z},v1:{x:n[1].x,y:n[1].y,z:n[1].z},v2:{x:n[2].x,y:n[2].y,z:n[2].z}})}return t}function qr(r){for(var t=[],e=0;e<r.length;e++){var n=r[e],a={x:n.v0.x,y:n.v0.y,z:n.v0.z},i={x:n.v1.x,y:n.v1.y,z:n.v1.z},v={x:n.v2.x,y:n.v2.y,z:n.v2.z};s({v0:a,v1:i,v2:v}).z<-.01?t.push({v0:a,v1:v,v2:i}):t.push({v0:a,v1:i,v2:v})}return t}function Cr(r){if(0===r.length)return r;function t(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var e={},n=0;n<r.length;n++)for(var a=r[n],i=t(a.v0),v=t(a.v1),o=t(a.v2),s=[{from:i,to:v},{from:v,to:o},{from:o,to:i}],h=0;h<3;h++){var l=s[h].from<s[h].to?s[h].from+"|"+s[h].to:s[h].to+"|"+s[h].from;e[l]||(e[l]=[]),e[l].push({triIdx:n,from:s[h].from,to:s[h].to})}var f=!0;for(var u in e)if(2!==e[u].length){f=!1;break}if(!f)return qr(r);for(var x=new Array(r.length),y=0;y<r.length;y++)x[y]=[];for(var c in e){var g=e[c];if(2===g.length){var z=g[0],d=g[1];x[z.triIdx].push({neighbor:d.triIdx,sameDirection:z.from===d.from}),x[d.triIdx].push({neighbor:z.triIdx,sameDirection:z.from===d.from})}}var p=new Uint8Array(r.length),M=new Uint8Array(r.length);M[0]=1;for(var m=[0],b=0;b<m.length;)for(var w=m[b++],k=x[w],_=0;_<k.length;_++){var F=k[_];if(!M[F.neighbor]){M[F.neighbor]=1;var A=p[w];F.sameDirection?p[F.neighbor]=A?0:1:p[F.neighbor]=A,m.push(F.neighbor)}}for(var I=[],S=0;S<r.length;S++){var E=r[S];p[S]?I.push({v0:{x:E.v0.x,y:E.v0.y,z:E.v0.z},v1:{x:E.v2.x,y:E.v2.y,z:E.v2.z},v2:{x:E.v1.x,y:E.v1.y,z:E.v1.z}}):I.push({v0:{x:E.v0.x,y:E.v0.y,z:E.v0.z},v1:{x:E.v1.x,y:E.v1.y,z:E.v1.z},v2:{x:E.v2.x,y:E.v2.y,z:E.v2.z}})}return I}function Xr(r,t){if(!t||0===t.length)return[r];var e=r.v1.x-r.v0.x,n=r.v1.y-r.v0.y,a=r.v1.z-r.v0.z,i=r.v2.x-r.v0.x,v=r.v2.y-r.v0.y,o=r.v2.z-r.v0.z,s=Math.sqrt(e*e+n*n+a*a);if(s<1e-12)return[r];var h=e/s,l=n/s,f=a/s,u=n*o-a*v,x=a*i-e*o,y=e*v-n*i;if(Math.sqrt(u*u+x*x+y*y)<1e-12)return[r];var c=x*f-y*l,g=y*h-u*f,z=u*l-x*h,d=Math.sqrt(c*c+g*g+z*z);if(d<1e-12)return[r];c/=d,g/=d,z/=d;var p=r.v0.x,M=r.v0.y,m=r.v0.z;function b(r){var t=r.x-p,e=r.y-M,n=r.z-m;return[t*h+e*l+n*f,t*c+e*g+n*z]}var w=b(r.v0),k=b(r.v1),_=b(r.v2),F=(k[1]-_[1])*(w[0]-_[0])+(_[0]-k[0])*(w[1]-_[1]);if(Math.abs(F)<1e-12)return[r];function A(r,t){var e=((k[1]-_[1])*(r-_[0])+(_[0]-k[0])*(t-_[1]))/F,n=((_[1]-w[1])*(r-_[0])+(w[0]-_[0])*(t-_[1]))/F;return[e,n,1-e-n]}for(var I=.5*Math.abs(F),S=[{x:r.v0.x,y:r.v0.y,z:r.v0.z},{x:r.v1.x,y:r.v1.y,z:r.v1.z},{x:r.v2.x,y:r.v2.y,z:r.v2.z}],E=0;E<t.length;E++)S.push(t[E]);for(var T,q=S.length,C=new Float64Array(2*q),X=0;X<q;X++){var Y=b(S[X]);C[2*X]=Y[0],C[2*X+1]=Y[1]}try{T=new fr(C)}catch(t){return[r]}for(var D=[],B=T.triangles,U=0;U<B.length;U+=3){var Z=B[U],O=B[U+1],V=B[U+2],P=A((C[2*Z]+C[2*O]+C[2*V])/3,(C[2*Z+1]+C[2*O+1]+C[2*V+1])/3);if(!(P[0]<-1e-6||P[1]<-1e-6||P[2]<-1e-6)){var j=C[2*Z],L=C[2*Z+1],K=C[2*O],N=C[2*O+1],W=C[2*V],R=C[2*V+1];.5*Math.abs((K-j)*(R-L)-(W-j)*(N-L))<1e-8*I||D.push({v0:S[Z],v1:S[O],v2:S[V]})}}return 0===D.length?[r]:D}function Yr(r,e,n){if(!r||0===r.length)return r;e||(e=1e-4),n||(n=3);function a(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var i=0,v=0,o=0;o<Math.min(r.length,200);o++){var s=r[o];i+=t(s.v0,s.v1)+t(s.v1,s.v2)+t(s.v2,s.v0),v+=3}for(var h=v>0?i/v:1,l=0;l<n;l++){for(var f=Math.max(h,100*e,.1),u=1/f,x={},y={},c=0;c<r.length;c++)for(var g=r[c],z=[g.v0,g.v1,g.v2],d=0;d<3;d++){var p=z[d],M=a(p);if(!y[M]){y[M]=!0;var m=Math.floor(p.x*u)+","+Math.floor(p.y*u)+","+Math.floor(p.z*u);x[m]||(x[m]=[]),x[m].push(p)}}for(var b=[],w=0,k=e*e,_=0;_<r.length;_++){for(var F=r[_],A=[F.v0,F.v1,F.v2],I=[a(A[0]),a(A[1]),a(A[2])],S=null,E=0;E<3;E++){var T=A[E],q=A[(E+1)%3],C=q.x-T.x,X=q.y-T.y,Y=q.z-T.z,D=C*C+X*X+Y*Y;if(!(D<1e-20)){var B=Math.sqrt(D),U=e/B;if(!(U>=.5))for(var Z={},O=Math.ceil(B/f)+1,V=0;V<=O;V++)for(var P=V/O,j=T.x+P*C,L=T.y+P*X,K=T.z+P*Y,N=Math.floor(j*u),W=Math.floor(L*u),R=Math.floor(K*u),G=-1;G<=1;G++)for(var H=-1;H<=1;H++)for(var J=-1;J<=1;J++){var Q=N+G+","+(W+H)+","+(R+J);if(!Z[Q]){Z[Q]=!0;var $=x[Q];if($)for(var rr=0;rr<$.length;rr++){var tr=$[rr],er=a(tr);if(er!==I[0]&&er!==I[1]&&er!==I[2]){var nr=((tr.x-T.x)*C+(tr.y-T.y)*X+(tr.z-T.z)*Y)/D;if(!(nr<=U||nr>=1-U)){var ar=T.x+nr*C,ir=T.y+nr*X,vr=T.z+nr*Y,or=tr.x-ar,sr=tr.y-ir,hr=tr.z-vr;or*or+sr*sr+hr*hr<k&&(S||(S=[]),S.push({x:tr.x,y:tr.y,z:tr.z}))}}}}}}}if(S){for(var lr={},fr=[],ur=0;ur<S.length;ur++){var xr=a(S[ur]);lr[xr]||(lr[xr]=!0,fr.push(S[ur]))}b[_]=fr,w++}}if(0===w)break;for(var yr=[],cr=0;cr<r.length;cr++)if(b[cr])for(var gr=Xr(r[cr],b[cr]),zr=0;zr<gr.length;zr++)yr.push(gr[zr]);else yr.push(r[cr]);r=yr}return r}function Dr(r,e,a){void 0===e&&(e=1e-6),void 0===a&&(a=.01);for(var i=[],v=0;v<r.length;v++){var o=r[v],s=n(o);if(!(s<e)){var h=t(o.v0,o.v1),l=t(o.v1,o.v2),f=t(o.v2,o.v0),u=Math.max(h,l,f);if(u>0)if(2*s/u/u<a)continue;i.push(o)}}return i}function Br(r,e){void 0===e&&(e=1);for(var n={},a={},o=0;o<r.length;o++)for(var s=r[o],h=[s.v0,s.v1,s.v2],l=[i(h[0]),i(h[1]),i(h[2])],f=0;f<3;f++){var u=(f+1)%3,x=v(l[f],l[u]);n[x]||(n[x]={count:0,v0:h[f],v1:h[u],k0:l[f],k1:l[u]}),n[x].count++,a[l[f]+"|"+l[u]]=!0}var y=[];for(var c in n)if(1===n[c].count){var g=n[c];a[g.k0+"|"+g.k1]?y.push({v0:g.v1,v1:g.v0,k0:g.k1,k1:g.k0}):y.push({v0:g.v0,v1:g.v1,k0:g.k0,k1:g.k1})}if(0===y.length)return[];var z=Math.max(3*e,.1),d={};function p(r){return Math.floor(r.x/z)+","+Math.floor(r.y/z)+","+Math.floor(r.z/z)}for(var M=0;M<y.length;M++)for(var m=y[M],b=0;b<2;b++){var w=0===b?m.v0:m.v1,k=p(w);d[k]||(d[k]=[]),d[k].push({edgeIdx:M,vertIdx:b,vertex:w})}for(var _={},F=[],A=0;A<y.length;A++)if(!_[A]){for(var I=y[A],S=-1,E=1/0,T=!1,q=Math.floor(I.v0.x/z),C=Math.floor(I.v0.y/z),X=Math.floor(I.v0.z/z),Y={},D=-1;D<=1;D++)for(var B=-1;B<=1;B++)for(var U=-1;U<=1;U++){var Z=d[q+D+","+(C+B)+","+(X+U)];if(Z)for(var O=0;O<Z.length;O++){var V=Z[O];V.edgeIdx===A||_[V.edgeIdx]||(Y[V.edgeIdx]=!0)}}for(var P in Y){var j=y[P],L=t(I.v0,j.v0),K=t(I.v1,j.v1),N=t(I.v0,j.v1),W=t(I.v1,j.v0),R=L+K,G=N+W;R<=G?L<=e&&K<=e&&R<E&&(S=parseInt(P),E=R,T=!1):N<=e&&W<=e&&G<E&&(S=parseInt(P),E=G,T=!0)}if(S>=0){var H=y[S];_[A]=!0,_[S]=!0;var J=T?H.v1:H.v0,Q=T?H.v0:H.v1;F.push({v0:I.v0,v1:I.v1,v2:J}),F.push({v0:I.v1,v1:Q,v2:J})}}return F}function Ur(r){for(var t=[],e={},a=[],o=0;o<r.length;o++){var s=r[o];t.push(n(s));var h=i(s.v0),l=i(s.v1),f=i(s.v2);a.push([h,l,f]);for(var u=[v(h,l),v(l,f),v(f,h)],x=0;x<3;x++)e[u[x]]||(e[u[x]]=[]),e[u[x]].push(o)}var y={};for(var c in e){var g=e[c];if(!(g.length<=2))for(var z=g.slice().sort(function(r,e){return t[e]-t[r]}),d=2;d<z.length;d++)y[z[d]]=!0}for(var p={},M=0;M<r.length;M++)if(!y[M]){var m=a[M].slice().sort().join("||");p[m]?y[M]=!0:p[m]=!0}if(0===Object.keys(y).length)return r;for(var b=[],w=0;w<r.length;w++)y[w]||b.push(r[w]);return b}function Zr(r){for(var t={},e={},n=0;n<r.length;n++)for(var a=r[n],o=[a.v0,a.v1,a.v2],s=[i(o[0]),i(o[1]),i(o[2])],h=0;h<3;h++){var l=(h+1)%3,f=v(s[h],s[l]);t[f]||(t[f]={count:0,v0:o[h],v1:o[l],k0:s[h],k1:s[l]}),t[f].count++,e[s[h]+"|"+s[l]]=!0}var u=[],x=0;for(var y in t)1===t[y].count?u.push(t[y]):t[y].count>2&&x++;if(0===u.length)return{loops:[],boundaryEdgeCount:0,overSharedEdgeCount:x};for(var c={},g=0;g<u.length;g++){var z,d,p,M,m=u[g];e[m.k0+"|"+m.k1]?(z=m.k1,d=m.k0,p=m.v1,M=m.v0):(z=m.k0,d=m.k1,p=m.v0,M=m.v1),c[z]||(c[z]=[]),c[z].push({key:d,vertex:M,fromVertex:p})}var b={},w=[];for(var k in c)if(!b[k]){for(var _=[],F=k,A=u.length+1;A-- >0&&!b[F];){b[F]=!0;var I=c[F];if(!I||0===I.length)break;for(var S=null,E=0;E<I.length;E++)if(!b[I[E].key]||I[E].key===k&&_.length>2){S=I[E];break}if(!S)break;if(_.push(S.fromVertex),(F=S.key)===k)break}_.length>=3&&w.push(_)}return{loops:w,boundaryEdgeCount:u.length,overSharedEdgeCount:x}}function Or(r,t,e,n){for(var a=!1,i=0,v=n-1;i<n;v=i++){var o=e[2*i],s=e[2*i+1],h=e[2*v],l=e[2*v+1];s>t!=l>t&&r<(h-o)*(t-s)/(l-s)+o&&(a=!a)}return a}function Vr(r){if(r.length<3)return[];if(3===r.length)return[{v0:r[0],v1:r[1],v2:r[2]}];if(4===r.length)return t(r[0],r[2])<=t(r[1],r[3])?[{v0:r[0],v1:r[1],v2:r[2]},{v0:r[0],v1:r[2],v2:r[3]}]:[{v0:r[0],v1:r[1],v2:r[3]},{v0:r[1],v1:r[2],v2:r[3]}];for(var e=0,n=0,a=0,i=0;i<r.length;i++){var v=r[i],o=r[(i+1)%r.length];e+=(v.y-o.y)*(v.z+o.z),n+=(v.z-o.z)*(v.x+o.x),a+=(v.x-o.x)*(v.y+o.y)}for(var s,h,l=0,f=0,u=0,x=0;x<r.length;x++){var y=r[x],c=r[(x+1)%r.length];l+=y.x*c.y-c.x*y.y,f+=y.x*c.z-c.x*y.z,u+=y.y*c.z-c.y*y.z}l=Math.abs(l),f=Math.abs(f),u=Math.abs(u),l>=f&&l>=u?(s=function(r){return r.x},h=function(r){return r.y}):f>=u?(s=function(r){return r.x},h=function(r){return r.z}):(s=function(r){return r.y},h=function(r){return r.z});for(var g,z,d=r.length,p=new Float64Array(2*d),M=0;M<d;M++)p[2*M]=s(r[M]),p[2*M+1]=h(r[M]);try{g=new fr(p),z=new wr(g);for(var m=0;m<d;m++){var b=(m+1)%d;try{z.constrainOne(m,b)}catch(r){}}}catch(r){try{g=new fr(p)}catch(r){return[]}}for(var w=[],k=g.triangles,_=0;_<k.length;_+=3){var F=k[_],A=k[_+1],I=k[_+2];Or((p[2*F]+p[2*A]+p[2*I])/3,(p[2*F+1]+p[2*A+1]+p[2*I+1])/3,p,d)&&w.push({v0:r[F],v1:r[A],v2:r[I]})}var S=Math.sqrt(e*e+n*n+a*a);if(S>1e-12)for(var E=e/S,T=n/S,q=a/S,C=0;C<w.length;C++){var X=w[C],Y=X.v1.x-X.v0.x,D=X.v1.y-X.v0.y,B=X.v1.z-X.v0.z,U=X.v2.x-X.v0.x,Z=X.v2.y-X.v0.y,O=X.v2.z-X.v0.z;if((D*O-B*Z)*E+(B*U-Y*O)*T+(Y*Z-D*U)*q<0){var V=X.v1;X.v1=X.v2,X.v2=V}}return w}function Pr(r,t,e){e||(e=3);for(var n=0;n<e;n++){if(o(r).overShared>0)r=Tr(Er(r=Ur(r),t).triangles);var a=Zr(r);if(0===a.loops.length)break;for(var i=0,v=0;v<a.loops.length;v++){var s=a.loops[v];if(!(s.length<3)&&!(s.length>500)){var h=Vr(s);if(0!==h.length){for(var l=0;l<h.length;l++)r.push(h[l]);if(i+=h.length,o(r=Tr(Er(r,t).triangles)).overShared>0)r=Tr(Er(r=Ur(r),t).triangles)}}}if(0===i)break}return r}function jr(r,t){for(var e={},n=0;n<r.length;n++){e[r[n].x+","+r[n].y+","+r[n].z]=n}for(var a=[],i=0;i<t.length;i++){var v=t[i].vertices,o=e[v[0].x+","+v[0].y+","+v[0].z],s=e[v[1].x+","+v[1].y+","+v[1].z],h=e[v[2].x+","+v[2].y+","+v[2].z];void 0!==o&&void 0!==s&&void 0!==h&&a.push([o,s,h])}for(var l={},f=0;f<r.length;f++){var u=r[f],x=Math.floor(u.x/2)+","+Math.floor(u.y/2)+","+Math.floor(u.z/2);l[x]||(l[x]=[]),l[x].push(f)}for(var y=0;y<30;y++){for(var c={},g=0;g<a.length;g++)for(var z=a[g],d=0;d<3;d++){var p=z[d],M=z[(d+1)%3],m=p<M?p+"|"+M:M+"|"+p;c[m]=(c[m]||0)+1}var b=[];for(var w in c)if(1===c[w]){var k=w.split("|");b.push([parseInt(k[0]),parseInt(k[1])])}if(0===b.length)break;for(var _=[],F={},A=0;A<b.length;A++){var I=b[A],S=I[0]<I[1]?I[0]+"|"+I[1]:I[1]+"|"+I[0];if(!F[S]){for(var E=r[I[0]],T=r[I[1]],q={x:(E.x+T.x)/2,y:(E.y+T.y)/2,z:(E.z+T.z)/2},C=Math.floor(q.x/2),X=Math.floor(q.y/2),Y=Math.floor(q.z/2),D=-1,B=1/0,U=-1;U<=1;U++)for(var Z=-1;Z<=1;Z++)for(var O=-1;O<=1;O++){var V=l[C+U+","+(X+Z)+","+(Y+O)];if(V)for(var P=0;P<V.length;P++){var j=V[P];if(j!==I[0]&&j!==I[1]){var L=r[j],K=q.x-L.x,N=q.y-L.y,W=q.z-L.z,R=K*K+N*N+W*W;if(!(R>=B)){var G=I[0]<j?I[0]+"|"+j:j+"|"+I[0],H=I[1]<j?I[1]+"|"+j:j+"|"+I[1];if(!((c[G]||0)>=2||(c[H]||0)>=2)){var J=T.x-E.x,Q=T.y-E.y,$=T.z-E.z,rr=L.x-E.x,tr=L.y-E.y,er=L.z-E.z,nr=Q*er-$*tr,ar=$*rr-J*er,ir=J*tr-Q*rr;nr*nr+ar*ar+ir*ir<1e-12||(D=j,B=R)}}}}}if(D>=0){a.push([I[0],I[1],D]),_.push([I[0],I[1],D]),F[S]=!0;var vr=I[0]<D?I[0]+"|"+D:D+"|"+I[0],or=I[1]<D?I[1]+"|"+D:D+"|"+I[1];c[vr]=(c[vr]||0)+1,c[or]=(c[or]||0)+1,c[S]=2}}}if(0===_.length)break;_.length}for(var sr=[],hr=0;hr<a.length;hr++){var lr=a[hr];sr.push({vertices:[{x:r[lr[0]].x,y:r[lr[0]].y,z:r[lr[0]].z},{x:r[lr[1]].x,y:r[lr[1]].y,z:r[lr[1]].z},{x:r[lr[2]].x,y:r[lr[2]].y,z:r[lr[2]].z}]})}return{points:r,triangles:sr}}wr.intersectSegments=kr,r.bboxOverlap=function(r,t){return r.minX<=t.maxX&&r.maxX>=t.minX&&r.minY<=t.maxY&&r.maxY>=t.minY&&r.minZ<=t.maxZ&&r.maxZ>=t.minZ},r.boolean=function(r,t,e){if(!r||!t||0===r.length||0===t.length)return null;var n=g(r,t);if(0===n.length){var a;if("union"===e)a=r.concat(t);else{if("intersect"===e)return null;a=r.slice()}var i=Er(a,0);return{soup:a,points:i.points,triangles:i.triangles}}for(var v={},o={},s=0;s<n.length;s++){var h=n[s];v[h.idxA]||(v[h.idxA]=[]),v[h.idxA].push(h),o[h.idxB]||(o[h.idxB]=[]),o[h.idxB].push(h)}var l=c(r),f=c(t),x=Math.max(2*l,.1),y=Math.max(2*f,.1),z=u(r,x),d=u(t,y),p=Ar(r,v,t,d,y),M=Ar(t,o,r,z,x),m=Ir(r,p,v,t,d,y),b=Ir(t,M,o,r,z,x);m.inside.length>0&&(m.inside=Sr(m.inside,1e-4)),m.outside.length>0&&(m.outside=Sr(m.outside,1e-4)),b.inside.length>0&&(b.inside=Sr(b.inside,1e-4)),b.outside.length>0&&(b.outside=Sr(b.outside,1e-4)),m.inside.length>0&&(m.inside=Cr(m.inside)),m.outside.length>0&&(m.outside=Cr(m.outside)),b.inside.length>0&&(b.inside=Cr(b.inside)),b.outside.length>0&&(b.outside=Cr(b.outside));var w=[];if("subtract"===e){for(var k=0;k<m.outside.length;k++)w.push(m.outside[k]);for(var _=function(r){for(var t=[],e=0;e<r.length;e++){var n=r[e];t.push({v0:{x:n.v0.x,y:n.v0.y,z:n.v0.z},v1:{x:n.v2.x,y:n.v2.y,z:n.v2.z},v2:{x:n.v1.x,y:n.v1.y,z:n.v1.z}})}return t}(b.inside),F=0;F<_.length;F++)w.push(_[F])}else if("union"===e){for(var A=0;A<m.outside.length;A++)w.push(m.outside[A]);for(var I=0;I<b.outside.length;I++)w.push(b.outside[I])}else{if("intersect"!==e)return null;for(var S=0;S<m.inside.length;S++)w.push(m.inside[S]);for(var E=0;E<b.inside.length;E++)w.push(b.inside[E])}if(0===w.length)return null;var T=Er(w,1e-4);return{soup:w,points:T.points,triangles:T.triangles}},r.buildCurtainAndCap=function(r,t){var e=Zr(r);if(0===e.loops.length)return[];for(var n=1/0,a=0;a<r.length;a++){var i=r[a];i.v0.z<n&&(n=i.v0.z),i.v1.z<n&&(n=i.v1.z),i.v2.z<n&&(n=i.v2.z)}for(var v=n-(t||10),o=[],s=0;s<e.loops.length;s++){for(var h=e.loops[s],l=[],f=0;f<h.length;f++){var u=h[f],x=h[(f+1)%h.length],y={x:u.x,y:u.y,z:v},c={x:x.x,y:x.y,z:v};o.push({v0:u,v1:x,v2:c}),o.push({v0:u,v1:c,v2:y}),l.push(y)}for(var g=Vr(l),z=0;z<g.length;z++)o.push({v0:g[z].v2,v1:g[z].v1,v2:g[z].v0})}return o},r.buildSpatialGrid=u,r.capBoundaryLoops=function(r){var t=Zr(r);if(0===t.loops.length)return[];for(var e=[],n=0;n<t.loops.length;n++)for(var a=Vr(t.loops[n]),i=0;i<a.length;i++)e.push(a[i]);return e},r.capBoundaryLoopsSequential=Pr,r.chainSegments=function(r,t){if(0===r.length)return[];var n=2*t,a={};function i(r){return Math.floor(r.x/n)+","+Math.floor(r.y/n)+","+Math.floor(r.z/n)}for(var v=0;v<r.length;v++)for(var o=[r[v].p0,r[v].p1],s=0;s<2;s++){var h=i(o[s]);a[h]||(a[h]=[]),a[h].push({segIdx:v,endIdx:s})}for(var l=t*t,f=new Array(r.length),u=0;u<f.length;u++)f[u]=!1;function x(t,i){for(var v=function(r){for(var t=Math.floor(r.x/n),e=Math.floor(r.y/n),a=Math.floor(r.z/n),i=[],v=-1;v<=1;v++)for(var o=-1;o<=1;o++)for(var s=-1;s<=1;s++)i.push(t+v+","+(e+o)+","+(a+s));return i}(t),o=l,s=-1,h=-1,u=0;u<v.length;u++){var x=a[v[u]];if(x)for(var y=0;y<x.length;y++){var c=x[y];if(!f[c.segIdx]&&c.segIdx!==i){var g=e(t,0===c.endIdx?r[c.segIdx].p0:r[c.segIdx].p1);g<o&&(o=g,s=c.segIdx,h=c.endIdx)}}}return s>=0?{segIdx:s,endIdx:h}:null}for(var y=[],c=0;c<r.length;c++)if(!f[c]){f[c]=!0;for(var g=[r[c].p0,r[c].p1],z=[],d=!0;d;){d=!1;var p=x(g[g.length-1],-1);if(p){f[p.segIdx]=!0;var M=r[p.segIdx];0===p.endIdx?g.push(M.p1):g.push(M.p0),d=!0}}for(d=!0;d;){d=!1;var m=x(z.length>0?z[z.length-1]:g[0],-1);if(m){f[m.segIdx]=!0;var b=r[m.segIdx];0===m.endIdx?z.push(b.p1):z.push(b.p0),d=!0}}if(z.length>0){z.reverse();var w=z.concat(g);y.push(w)}else y.push(g)}return y},r.classifyByFloodFill=Ar,r.classifyNormalDirection=function(r,t,e){if(0===r.length)return"N/A";for(var n=0,a=0,i=0,v=0,o=0;o<r.length;o++){var s=r[o].v0,h=r[o].v1,l=r[o].v2,f=h.x-s.x,u=h.y-s.y,x=h.z-s.z,y=l.x-s.x,c=l.y-s.y,g=l.z-s.z,z=u*g-x*c,d=x*y-f*g,p=f*c-u*y,M=.5*Math.sqrt(z*z+d*d+p*p);M<1e-12||(n+=.5*z,a+=.5*d,i+=.5*p,v+=M)}if(v<1e-12)return"N/A";if(t){if(e>1e-6)return"Out";if(e<-1e-6)return"In"}var m=Math.sqrt(n*n+a*a+i*i),b=m/v;if(b<.15)return e>1e-6?t?"Out":"~Out":e<-1e-6?t?"In":"~In":"Chaos";var w=n/m,k=a/m,_=i/m,F=Math.abs(w),A=Math.abs(k),I=Math.abs(_);return I>.7&&I>=F&&I>=A?_>0?"Z+":"Z-":F>.7&&F>=A&&F>=I?w>0?"X+":"X-":A>.7&&A>=F&&A>=I?k>0?"Y+":"Y-":b>.5?"Aligned":"Chaos"},r.classifyPointByRayCast=Fr,r.cleanCrossingTriangles=Ur,r.compute3DSurfaceArea=function(r){for(var t=0,e=0;e<r.length;e++){var n=r[e].v0,a=r[e].v1,i=r[e].v2,v=a.x-n.x,o=a.y-n.y,s=a.z-n.z,h=i.x-n.x,l=i.y-n.y,f=i.z-n.z,u=o*f-s*l,x=s*h-v*f,y=v*l-o*h;t+=.5*Math.sqrt(u*u+x*x+y*y)}return t},r.computeBBox=function(r){for(var t=1/0,e=1/0,n=1/0,a=-1/0,i=-1/0,v=-1/0,o=0;o<r.length;o++)for(var s=r[o],h=[s.v0,s.v1,s.v2],l=0;l<3;l++){var f=h[l];f.x<t&&(t=f.x),f.y<e&&(e=f.y),f.z<n&&(n=f.z),f.x>a&&(a=f.x),f.y>i&&(i=f.y),f.z>v&&(v=f.z)}return{minX:t,minY:e,minZ:n,maxX:a,maxY:i,maxZ:v}},r.computeBounds=function(r){for(var t=1/0,e=1/0,n=1/0,a=-1/0,i=-1/0,v=-1/0,o=0;o<r.length;o++){var s=r[o];s.x<t&&(t=s.x),s.y<e&&(e=s.y),s.z<n&&(n=s.z),s.x>a&&(a=s.x),s.y>i&&(i=s.y),s.z>v&&(v=s.z)}return{minX:t,maxX:a,minY:e,maxY:i,minZ:n,maxZ:v}},r.computeProjectedArea=function(r,t){for(var e=0,n=0;n<r.length;n++){var a=r[n].v0,i=r[n].v1,v=r[n].v2,o=s(r[n]);if("xy"===t){if(o.z<=0)continue;var h=(i.x-a.x)*(v.y-a.y)-(v.x-a.x)*(i.y-a.y);e+=Math.abs(h)/2}else if("yz"===t){if(o.x<=0)continue;var l=(i.y-a.y)*(v.z-a.z)-(v.y-a.y)*(i.z-a.z);e+=Math.abs(l)/2}else if("xz"===t){if(o.y<=0)continue;var f=(i.x-a.x)*(v.z-a.z)-(v.x-a.x)*(i.z-a.z);e+=Math.abs(f)/2}}return e},r.computeSignedVolume=function(r){if(0===r.length)return 0;for(var t=0,e=0,n=0,a=r.length,i=0;i<a;i++)t+=r[i].v0.x+r[i].v1.x+r[i].v2.x,e+=r[i].v0.y+r[i].v1.y+r[i].v2.y,n+=r[i].v0.z+r[i].v1.z+r[i].v2.z;var v=1/(3*a);t*=v,e*=v,n*=v;for(var o=0,s=0;s<a;s++){var h=r[s].v0.x-t,l=r[s].v0.y-e,f=r[s].v0.z-n,u=r[s].v1.x-t,x=r[s].v1.y-e,y=r[s].v1.z-n,c=r[s].v2.x-t,g=r[s].v2.y-e,z=r[s].v2.z-n;o+=(h*(x*z-g*y)-u*(l*z-g*f)+c*(l*y-x*f))/6}return o},r.countOpenEdges=o,r.cross=a,r.deduplicateSeamVertices=Sr,r.dist3=t,r.distSq3=e,r.edgeKey=v,r.ensureZUpNormals=qr,r.estimateAvgEdge=c,r.extractBoundaryLoops=Zr,r.flipAllNormals=function(r){for(var t=[],e=0;e<r.length;e++){var n=r[e];t.push({v0:{x:n.v0.x,y:n.v0.y,z:n.v0.z},v1:{x:n.v2.x,y:n.v2.y,z:n.v2.z},v2:{x:n.v1.x,y:n.v1.y,z:n.v1.z}})}return t},r.forceCloseIndexedMesh=jr,r.generateClosingTriangles=function(r,t){function e(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return e*e+n*n+a*a}function n(r,t,e){var n=t.x-r.x,a=t.y-r.y,i=t.z-r.z,v=e.x-r.x,o=e.y-r.y,s=e.z-r.z,h=a*s-i*o,l=i*v-n*s,f=n*o-a*v;return.5*Math.sqrt(h*h+l*l+f*f)}for(var a=t*t,o=0;o<20;o++){for(var s={},h={},l=0;l<r.length;l++)for(var f=r[l],u=[f.v0,f.v1,f.v2],x=[i(u[0]),i(u[1]),i(u[2])],y=0;y<3;y++){h[x[y]]=u[y];var c=v(x[y],x[(y+1)%3]);s[c]=(s[c]||0)+1}var g=[];for(var z in s)if(1===s[z]){var d=z.split("|");g.push({k0:d[0],k1:d[1]})}if(0===g.length)return r;for(var p=Math.max(t,1),M={},m=Object.keys(h),b=0;b<m.length;b++){var w=h[m[b]],k=Math.floor(w.x/p)+","+Math.floor(w.y/p)+","+Math.floor(w.z/p);M[k]||(M[k]=[]),M[k].push(m[b])}for(var _=[],F={},A=0;A<g.length;A++){var I=g[A],S=v(I.k0,I.k1);if(!F[S]){for(var E=h[I.k0],T=h[I.k1],q={x:(E.x+T.x)/2,y:(E.y+T.y)/2,z:(E.z+T.z)/2},C=null,X=1/0,Y=Math.floor(q.x/p),D=Math.floor(q.y/p),B=Math.floor(q.z/p),U=-1;U<=1;U++)for(var Z=-1;Z<=1;Z++)for(var O=-1;O<=1;O++){var V=M[Y+U+","+(D+Z)+","+(B+O)];if(V)for(var P=0;P<V.length;P++){var j=V[P];if(j!==I.k0&&j!==I.k1){var L=h[j],K=e(q,L);if(!(K>a||K>=X)){var N=v(I.k0,j),W=v(I.k1,j),R=s[N]||0,G=s[W]||0;if(!(R>=2||G>=2))n(E,T,L)<1e-6||(C=j,X=K)}}}}if(null!==C){var H=h[C];_.push({v0:E,v1:T,v2:H}),F[S]=!0;var J=v(I.k0,C),Q=v(I.k1,C);s[J]=(s[J]||0)+1,s[Q]=(s[Q]||0)+1,s[S]=2}}}if(0===_.length)return r;for(var $=0;$<_.length;$++)r.push(_[$]);_.length}return r},r.intersectMeshPair=function(r,t){for(var e=[],n=c(t),a=Math.max(2*n,.1),i=u(t,a),v=0;v<r.length;v++)for(var o=r[v],s=x(i,y(o),a),l=0;l<s.length;l++){var f=h(o,t[s[l]]);f&&e.push(f)}return e},r.intersectMeshPairTagged=g,r.lerpVert=function(r,t,e){return{x:r.x+e*(t.x-r.x),y:r.y+e*(t.y-r.y),z:r.z+e*(t.z-r.z)}},r.queryGrid=x,r.removeDegenerateTriangles=Dr,r.removeOverlappingTriangles=function(r,e){void 0===e&&(e=.5);for(var n=[],a=[],i=[],v=0;v<r.length;v++){var o=r[v];n.push({x:(o.v0.x+o.v1.x+o.v2.x)/3,y:(o.v0.y+o.v1.y+o.v2.y)/3,z:(o.v0.z+o.v1.z+o.v2.z)/3});var s=o.v1.x-o.v0.x,h=o.v1.y-o.v0.y,l=o.v1.z-o.v0.z,f=o.v2.x-o.v0.x,u=o.v2.y-o.v0.y,x=o.v2.z-o.v0.z,y=h*x-l*u,c=l*f-s*x,g=s*u-h*f,z=Math.sqrt(y*y+c*c+g*g);z>0&&(y/=z,c/=z,g/=z),a.push({x:y,y:c,z:g}),i.push(.5*z)}var d=Math.max(2*e,.1),p={};function M(r){return Math.floor(r.x/d)+","+Math.floor(r.y/d)+","+Math.floor(r.z/d)}for(var m=0;m<r.length;m++){var b=M(n[m]);p[b]||(p[b]=[]),p[b].push(m)}for(var w={},k=0;k<r.length;k++)if(!w[k])for(var _=n[k],F=Math.floor(_.x/d),A=Math.floor(_.y/d),I=Math.floor(_.z/d),S=-1;S<=1;S++)for(var E=-1;E<=1;E++)for(var T=-1;T<=1;T++){var q=p[F+S+","+(A+E)+","+(I+T)];if(q)for(var C=0;C<q.length;C++){var X=q[C];if(!(X<=k||w[X]))if(!(t(_,n[X])>e))if(!(Math.min(i[k],i[X])/Math.max(i[k],i[X])<.3)){var Y=a[k].x*a[X].x+a[k].y*a[X].y+a[k].z*a[X].z;(Y<-.5||Y>.5)&&(i[k]<=i[X]?w[k]=!0:w[X]=!0)}}}if(0===Object.keys(w).length)return r;for(var D=[],B=0;B<r.length;B++)w[B]||D.push(r[B]);return D},r.repairMesh=async function(r,t,e){t||(t={});var n=t.closeMode||"none",a=t.snapTolerance||0,i=t.stitchTolerance||1,v=!1!==t.removeDegenerate;function s(r){"function"==typeof e&&e(r)}function h(){return new Promise(function(r){setTimeout(r,0)})}if(s("Deduplicating vertices..."),await h(),r=Sr(r,1e-4),s("Resolving T-junctions..."),await h(),r=Yr(r,1e-4),s("Welding vertices..."),await h(),r=Tr(Er(r,a).triangles),v&&(s("Removing degenerate triangles..."),await h(),r=Dr(r,1e-6,.01)),"stitch"===n){s("Stitching boundaries..."),await h();var l=Br(r,i);if(l.length>0)for(var f=0;f<l.length;f++)r.push(l[f]);var u=Er(r,a),x=u.points,y=u.triangles;s("Capping boundary loops..."),await h();var c=Tr(y),g=Er(c=Pr(c,a,3),a);x=g.points,y=g.triangles,s("Cleaning up post-cap mesh..."),await h();var z=Tr(y),d=!1;if(o(z).overShared>0&&(z=Ur(z),d=!0),v){var p=z.length;(z=Dr(z,1e-6,.01)).length<p&&(d=!0)}if(d){var M=Er(z,a);x=M.points,y=M.triangles}if(s("Force-closing gaps..."),await h(),o(Tr(y)).openEdges>0){var m=jr(x,y);x=m.points,y=m.triangles}return r=Tr(y),s("Repair complete."),{points:x,triangles:y,soup:r}}var b=Er(r,a);return s("Repair complete."),{points:b.points,triangles:b.triangles,soup:r}},r.resolveTJunctions=Yr,r.retriangulateWithSteinerPoints=_r,r.simplifyPolyline=function(r,e){if(r.length<=2||e<=0)return r;for(var n=[r[0]],a=0,i=1;i<r.length-1;i++)(a+=t(r[i-1],r[i]))>=e&&(n.push(r[i]),a=0);return n.push(r[r.length-1]),n},r.stitchByProximity=Br,r.triBBox=y,r.triNormal=s,r.triTriIntersection=h,r.triTriIntersectionDetailed=function(r,t){var e=s(t),n=-(e.x*t.v0.x+e.y*t.v0.y+e.z*t.v0.z),i=e.x*r.v0.x+e.y*r.v0.y+e.z*r.v0.z+n,v=e.x*r.v1.x+e.y*r.v1.y+e.z*r.v1.z+n,o=e.x*r.v2.x+e.y*r.v2.y+e.z*r.v2.z+n;if(i>0&&v>0&&o>0)return null;if(i<0&&v<0&&o<0)return null;var h=s(r),u=-(h.x*r.v0.x+h.y*r.v0.y+h.z*r.v0.z),x=h.x*t.v0.x+h.y*t.v0.y+h.z*t.v0.z+u,y=h.x*t.v1.x+h.y*t.v1.y+h.z*t.v1.z+u,c=h.x*t.v2.x+h.y*t.v2.y+h.z*t.v2.z+u;if(x>0&&y>0&&c>0)return null;if(x<0&&y<0&&c<0)return null;var g=h.x*e.x+h.y*e.y+h.z*e.z;if(Math.abs(g)>.9999)return null;var z=a(h,e),d=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);if(d<1e-12)return null;z.x/=d,z.y/=d,z.z/=d;var p=f(h,u,e,n,z);if(!p)return null;var M=l(r,z,p,i,v,o);if(!M)return null;var m=l(t,z,p,x,y,c);if(!m)return null;var b=Math.max(M.min,m.min),w=Math.min(M.max,m.max);if(b>=w-1e-10)return null;var k=w-b;return k<1e-8?null:{dA:[i,v,o],dB:[x,y,c],segLen:k}},r.triangleArea3D=n,r.triangulateLoop=Vr,r.vKey=i,r.weldBoundaryVertices=function(r,t){if(t<=0)return r;for(var e={},n=0;n<r.length;n++)for(var a=r[n],o=[a.v0,a.v1,a.v2],s=[i(o[0]),i(o[1]),i(o[2])],h=0;h<3;h++){var l=(h+1)%3,f=v(s[h],s[l]);e[f]||(e[f]={count:0,k0:s[h],k1:s[l],v0:o[h],v1:o[l]}),e[f].count++}var u={};for(var x in e)1===e[x].count&&(u[e[x].k0]=e[x].v0,u[e[x].k1]=e[x].v1);var y=Object.keys(u);if(0===y.length)return r;for(var c=Math.max(2*t,.01),g={},z=t*t,d=0;d<y.length;d++){var p=u[y[d]],M=Math.floor(p.x/c)+","+Math.floor(p.y/c)+","+Math.floor(p.z/c);g[M]||(g[M]=[]),g[M].push(y[d])}for(var m={},b=0;b<y.length;b++)m[y[b]]=y[b];function w(r){for(;m[r]!==r;)m[r]=m[m[r]],r=m[r];return r}function k(r,t){var e=w(r),n=w(t);e!==n&&(m[e]=n)}for(var _=0;_<y.length;_++)for(var F=u[y[_]],A=Math.floor(F.x/c),I=Math.floor(F.y/c),S=Math.floor(F.z/c),E=-1;E<=1;E++)for(var T=-1;T<=1;T++)for(var q=-1;q<=1;q++){var C=g[A+E+","+(I+T)+","+(S+q)];if(C)for(var X=0;X<C.length;X++)if(C[X]!==y[_]){var Y=u[C[X]],D=F.x-Y.x,B=F.y-Y.y,U=F.z-Y.z;D*D+B*B+U*U<=z&&k(y[_],C[X])}}for(var Z={},O=0;O<y.length;O++){var V=w(y[O]),P=u[y[O]];Z[V]||(Z[V]={sumX:0,sumY:0,sumZ:0,count:0}),Z[V].sumX+=P.x,Z[V].sumY+=P.y,Z[V].sumZ+=P.z,Z[V].count++}for(var j={},L=0,K=0;K<y.length;K++){var N=Z[w(y[K])];N.count>1&&(j[y[K]]={x:N.sumX/N.count,y:N.sumY/N.count,z:N.sumZ/N.count},L++)}if(0===L)return r;function W(r){var t=i(r);return j[t]?j[t]:r}for(var R=[],G=0;G<r.length;G++){var H=W(r[G].v0),J=W(r[G].v1),Q=W(r[G].v2),$=i(H),rr=i(J),tr=i(Q);$!==rr&&rr!==tr&&$!==tr&&R.push({v0:H,v1:J,v2:Q})}return R},r.weldVertices=Er,r.weldedToSoup=Tr});
//# sourceMappingURL=trimesh-boolean.min.js.map
