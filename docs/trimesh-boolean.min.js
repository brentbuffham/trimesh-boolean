!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r="undefined"!=typeof globalThis?globalThis:r||self).TrimeshBoolean={})}(this,function(r){"use strict";function t(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return Math.sqrt(e*e+n*n+a*a)}function e(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return e*e+n*n+a*a}function n(r){var t=r.v1.x-r.v0.x,e=r.v1.y-r.v0.y,n=r.v1.z-r.v0.z,a=r.v2.x-r.v0.x,i=r.v2.y-r.v0.y,v=r.v2.z-r.v0.z,o=e*v-n*i,s=n*a-t*v,h=t*i-e*a;return.5*Math.sqrt(o*o+s*s+h*h)}function a(r,t){return{x:r.y*t.z-r.z*t.y,y:r.z*t.x-r.x*t.z,z:r.x*t.y-r.y*t.x}}function i(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}function v(r,t){return r<t?r+"|"+t:t+"|"+r}function o(r){for(var t={},e=0;e<r.length;e++)for(var n=r[e],a=[n.v0,n.v1,n.v2],o=[i(a[0]),i(a[1]),i(a[2])],s=0;s<3;s++){var h=v(o[s],o[(s+1)%3]);t[h]||(t[h]=0),t[h]++}var l=0,f=0,u=0;for(var x in t)u++,1===t[x]?l++:t[x]>2&&f++;return{openEdges:l,overShared:f,total:u}}function s(r){var t=a({x:r.v1.x-r.v0.x,y:r.v1.y-r.v0.y,z:r.v1.z-r.v0.z},{x:r.v2.x-r.v0.x,y:r.v2.y-r.v0.y,z:r.v2.z-r.v0.z}),e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return e<1e-15?{x:0,y:0,z:1}:{x:t.x/e,y:t.y/e,z:t.z/e}}function h(r,t){var e=s(t),n=-(e.x*t.v0.x+e.y*t.v0.y+e.z*t.v0.z),i=e.x*r.v0.x+e.y*r.v0.y+e.z*r.v0.z+n,v=e.x*r.v1.x+e.y*r.v1.y+e.z*r.v1.z+n,o=e.x*r.v2.x+e.y*r.v2.y+e.z*r.v2.z+n;if(i>0&&v>0&&o>0)return null;if(i<0&&v<0&&o<0)return null;var h=s(r),u=-(h.x*r.v0.x+h.y*r.v0.y+h.z*r.v0.z),x=h.x*t.v0.x+h.y*t.v0.y+h.z*t.v0.z+u,y=h.x*t.v1.x+h.y*t.v1.y+h.z*t.v1.z+u,c=h.x*t.v2.x+h.y*t.v2.y+h.z*t.v2.z+u;if(x>0&&y>0&&c>0)return null;if(x<0&&y<0&&c<0)return null;var z=h.x*e.x+h.y*e.y+h.z*e.z;if(Math.abs(z)>.9999)return null;var g=a(h,e),d=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);if(d<1e-12)return null;g.x/=d,g.y/=d,g.z/=d;var p=f(h,u,e,n,g);if(!p)return null;var M=l(r,g,p,i,v,o);if(!M)return null;var m=l(t,g,p,x,y,c);if(!m)return null;var b=Math.max(M.min,m.min),w=Math.min(M.max,m.max);if(b>=w-1e-10)return null;var k={x:p.x+g.x*b,y:p.y+g.y*b,z:p.z+g.z*b},_={x:p.x+g.x*w,y:p.y+g.y*w,z:p.z+g.z*w},F=k.x-_.x,A=k.y-_.y,S=k.z-_.z;return Math.sqrt(F*F+A*A+S*S)<1e-8?null:{p0:k,p1:_}}function l(r,t,e,n,a,i){for(var v=[r.v0,r.v1,r.v2],o=[n,a,i],s=[],h=0;h<3;h++){var l=(h+1)%3,f=o[h],u=o[l];if(f>0&&u<0||f<0&&u>0){var x=f/(f-u),y={x:v[h].x+x*(v[l].x-v[h].x),y:v[h].y+x*(v[l].y-v[h].y),z:v[h].z+x*(v[l].z-v[h].z)},c=(y.x-e.x)*t.x+(y.y-e.y)*t.y+(y.z-e.z)*t.z;s.push(c)}else if(Math.abs(f)<1e-10){var z=(v[h].x-e.x)*t.x+(v[h].y-e.y)*t.y+(v[h].z-e.z)*t.z;s.push(z)}}return s.length<2?null:(s.sort(function(r,t){return r-t}),{min:s[0],max:s[s.length-1]})}function f(r,t,e,n,a){var i,v,o,s=Math.abs(a.x),h=Math.abs(a.y),l=Math.abs(a.z);if(l>=s&&l>=h){var f=r.x*e.y-r.y*e.x;if(Math.abs(f)<1e-12)return null;i=(-t*e.y+n*r.y)/f,v=(r.x*-n-e.x*-t)/f,o=0}else if(h>=s){var u=r.x*e.z-r.z*e.x;if(Math.abs(u)<1e-12)return null;i=(-t*e.z+n*r.z)/u,v=0,o=(r.x*-n-e.x*-t)/u}else{var x=r.y*e.z-r.z*e.y;if(Math.abs(x)<1e-12)return null;i=0,v=(-t*e.z+n*r.z)/x,o=(r.y*-n-e.y*-t)/x}return{x:i,y:v,z:o}}function u(r,t,e,n){for(var a={},i=0;i<r.length;i++){for(var v=r[i],o=[v.v0,v.v1,v.v2],s=1/0,h=-1/0,l=1/0,f=-1/0,u=0;u<3;u++){var x=e(o[u]),y=n(o[u]);x<s&&(s=x),x>h&&(h=x),y<l&&(l=y),y>f&&(f=y)}for(var c=Math.floor(s/t),z=Math.floor(l/t),g=Math.floor(h/t),d=Math.floor(f/t),p=c;p<=g;p++)for(var M=z;M<=d;M++){var m=p+","+M;a[m]||(a[m]=[]),a[m].push(i)}}return a}function x(r,t,e,n){var a=r[Math.floor(t/n)+","+Math.floor(e/n)];return a||[]}function y(r,t){for(var e={},n=0;n<r.length;n++)for(var a=z(r[n]),i=Math.floor(a.minX/t),v=Math.floor(a.minY/t),o=Math.floor(a.maxX/t),s=Math.floor(a.maxY/t),h=i;h<=o;h++)for(var l=v;l<=s;l++){var f=h+","+l;e[f]||(e[f]=[]),e[f].push(n)}return e}function c(r,t,e){for(var n=Math.floor(t.minX/e),a=Math.floor(t.minY/e),i=Math.floor(t.maxX/e),v=Math.floor(t.maxY/e),o={},s=[],h=n;h<=i;h++)for(var l=a;l<=v;l++){var f=r[h+","+l];if(f)for(var u=0;u<f.length;u++){var x=f[u];o[x]||(o[x]=!0,s.push(x))}}return s}function z(r){return{minX:Math.min(r.v0.x,r.v1.x,r.v2.x),minY:Math.min(r.v0.y,r.v1.y,r.v2.y),minZ:Math.min(r.v0.z,r.v1.z,r.v2.z),maxX:Math.max(r.v0.x,r.v1.x,r.v2.x),maxY:Math.max(r.v0.y,r.v1.y,r.v2.y),maxZ:Math.max(r.v0.z,r.v1.z,r.v2.z)}}function g(r){if(0===r.length)return 1;for(var e=0,n=Math.min(r.length,100),a=0;a<n;a++){var i=r[a];e+=t(i.v0,i.v1),e+=t(i.v1,i.v2),e+=t(i.v2,i.v0)}return e/(3*n)}function d(r,t){for(var e=[],n=g(t),a=Math.max(2*n,.1),i=y(t,a),v=0;v<r.length;v++)for(var o=r[v],s=c(i,z(o),a),l=0;l<s.length;l++){var f=s[l],u=h(o,t[f]);u&&e.push({p0:u.p0,p1:u.p1,idxA:v,idxB:f})}return e}const p=11102230246251565e-32,M=134217729,m=(3+8*p)*p;function b(r,t,e,n,a){let i,v,o,s,h=t[0],l=n[0],f=0,u=0;l>h==l>-h?(i=h,h=t[++f]):(i=l,l=n[++u]);let x=0;if(f<r&&u<e)for(l>h==l>-h?(v=h+i,o=i-(v-h),h=t[++f]):(v=l+i,o=i-(v-l),l=n[++u]),i=v,0!==o&&(a[x++]=o);f<r&&u<e;)l>h==l>-h?(v=i+h,s=v-i,o=i-(v-s)+(h-s),h=t[++f]):(v=i+l,s=v-i,o=i-(v-s)+(l-s),l=n[++u]),i=v,0!==o&&(a[x++]=o);for(;f<r;)v=i+h,s=v-i,o=i-(v-s)+(h-s),h=t[++f],i=v,0!==o&&(a[x++]=o);for(;u<e;)v=i+l,s=v-i,o=i-(v-s)+(l-s),l=n[++u],i=v,0!==o&&(a[x++]=o);return 0===i&&0!==x||(a[x++]=i),x}function w(r,t,e,n,a,i,v,o){return b(b(r,t,e,n,v),v,a,i,o)}function k(r,t,e,n){let a,i,v,o,s,h,l,f,u,x,y;l=M*e,x=l-(l-e),y=e-x;let c=t[0];a=c*e,l=M*c,f=l-(l-c),u=c-f,v=u*y-(a-f*x-u*x-f*y);let z=0;0!==v&&(n[z++]=v);for(let g=1;g<r;g++)c=t[g],o=c*e,l=M*c,f=l-(l-c),u=c-f,s=u*y-(o-f*x-u*x-f*y),i=a+s,h=i-a,v=a-(i-h)+(s-h),0!==v&&(n[z++]=v),a=o+i,v=i-(a-o),0!==v&&(n[z++]=v);return 0===a&&0!==z||(n[z++]=a),z}function _(r,t){let e=t[0];for(let n=1;n<r;n++)e+=t[n];return e}function F(r){return new Float64Array(r)}const A=F(4),S=F(8),I=F(12),E=F(16),T=F(4);function q(r,t,e,n,a,i){const v=(t-i)*(e-a),o=(r-a)*(n-i),s=v-o,h=Math.abs(v+o);return Math.abs(s)>=33306690738754716e-32*h?s:-function(r,t,e,n,a,i,v){let o,s,h,l,f,u,x,y,c,z,g,d,p,w,k,F,q,C;const X=r-a,Y=e-a,D=t-i,B=n-i;w=X*B,u=M*X,x=u-(u-X),y=X-x,u=M*B,c=u-(u-B),z=B-c,k=y*z-(w-x*c-y*c-x*z),F=D*Y,u=M*D,x=u-(u-D),y=D-x,u=M*Y,c=u-(u-Y),z=Y-c,q=y*z-(F-x*c-y*c-x*z),g=k-q,f=k-g,A[0]=k-(g+f)+(f-q),d=w+g,f=d-w,p=w-(d-f)+(g-f),g=p-F,f=p-g,A[1]=p-(g+f)+(f-F),C=d+g,f=C-d,A[2]=d-(C-f)+(g-f),A[3]=C;let O=_(4,A),U=22204460492503146e-32*v;if(O>=U||-O>=U)return O;if(f=r-X,o=r-(X+f)+(f-a),f=e-Y,h=e-(Y+f)+(f-a),f=t-D,s=t-(D+f)+(f-i),f=n-B,l=n-(B+f)+(f-i),0===o&&0===s&&0===h&&0===l)return O;if(U=11093356479670487e-47*v+m*Math.abs(O),O+=X*l+B*o-(D*h+Y*s),O>=U||-O>=U)return O;w=o*B,u=M*o,x=u-(u-o),y=o-x,u=M*B,c=u-(u-B),z=B-c,k=y*z-(w-x*c-y*c-x*z),F=s*Y,u=M*s,x=u-(u-s),y=s-x,u=M*Y,c=u-(u-Y),z=Y-c,q=y*z-(F-x*c-y*c-x*z),g=k-q,f=k-g,T[0]=k-(g+f)+(f-q),d=w+g,f=d-w,p=w-(d-f)+(g-f),g=p-F,f=p-g,T[1]=p-(g+f)+(f-F),C=d+g,f=C-d,T[2]=d-(C-f)+(g-f),T[3]=C;const Z=b(4,A,4,T,S);w=X*l,u=M*X,x=u-(u-X),y=X-x,u=M*l,c=u-(u-l),z=l-c,k=y*z-(w-x*c-y*c-x*z),F=D*h,u=M*D,x=u-(u-D),y=D-x,u=M*h,c=u-(u-h),z=h-c,q=y*z-(F-x*c-y*c-x*z),g=k-q,f=k-g,T[0]=k-(g+f)+(f-q),d=w+g,f=d-w,p=w-(d-f)+(g-f),g=p-F,f=p-g,T[1]=p-(g+f)+(f-F),C=d+g,f=C-d,T[2]=d-(C-f)+(g-f),T[3]=C;const V=b(Z,S,4,T,I);w=o*l,u=M*o,x=u-(u-o),y=o-x,u=M*l,c=u-(u-l),z=l-c,k=y*z-(w-x*c-y*c-x*z),F=s*h,u=M*s,x=u-(u-s),y=s-x,u=M*h,c=u-(u-h),z=h-c,q=y*z-(F-x*c-y*c-x*z),g=k-q,f=k-g,T[0]=k-(g+f)+(f-q),d=w+g,f=d-w,p=w-(d-f)+(g-f),g=p-F,f=p-g,T[1]=p-(g+f)+(f-F),C=d+g,f=C-d,T[2]=d-(C-f)+(g-f),T[3]=C;const P=b(V,I,4,T,E);return E[P-1]}(r,t,e,n,a,i,h)}const C=F(4),X=F(4),Y=F(4),D=F(4),B=F(4),O=F(4),U=F(4),Z=F(4),V=F(8),P=F(8),j=F(8),L=F(8),K=F(8),N=F(8),W=F(8),G=F(8),R=F(8),H=F(4),J=F(4),Q=F(4),$=F(8),rr=F(16),tr=F(16),er=F(16),nr=F(32),ar=F(32),ir=F(48),vr=F(64);let or=F(1152),sr=F(1152);function hr(r,t,e){r=b(r,or,t,e,sr);const n=or;return or=sr,sr=n,r}function lr(r,t,e,n,a,i,v,o){const s=r-v,h=e-v,l=a-v,f=t-o,u=n-o,x=i-o,y=h*x,c=l*u,z=s*s+f*f,g=l*f,d=s*x,p=h*h+u*u,F=s*u,A=h*f,S=l*l+x*x,I=z*(y-c)+p*(g-d)+S*(F-A),E=(Math.abs(y)+Math.abs(c))*z+(Math.abs(g)+Math.abs(d))*p+(Math.abs(F)+Math.abs(A))*S,T=11102230246251577e-31*E;return I>T||-I>T?I:function(r,t,e,n,a,i,v,o,s){let h,l,f,u,x,y,c,z,g,d,p,F,A,S,I,E,T,q,sr,lr,fr,ur,xr,yr,cr,zr,gr,dr,pr,Mr,mr,br,wr,kr,_r;const Fr=r-v,Ar=e-v,Sr=a-v,Ir=t-o,Er=n-o,Tr=i-o;mr=Ar*Tr,xr=M*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=M*Tr,zr=xr-(xr-Tr),gr=Tr-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Sr*Er,xr=M*Sr,yr=xr-(xr-Sr),cr=Sr-yr,xr=M*Er,zr=xr-(xr-Er),gr=Er-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,C[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,C[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,C[2]=pr-(_r-ur)+(dr-ur),C[3]=_r,mr=Sr*Ir,xr=M*Sr,yr=xr-(xr-Sr),cr=Sr-yr,xr=M*Ir,zr=xr-(xr-Ir),gr=Ir-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Fr*Tr,xr=M*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=M*Tr,zr=xr-(xr-Tr),gr=Tr-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,X[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,X[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,X[2]=pr-(_r-ur)+(dr-ur),X[3]=_r,mr=Fr*Er,xr=M*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=M*Er,zr=xr-(xr-Er),gr=Er-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Ar*Ir,xr=M*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=M*Ir,zr=xr-(xr-Ir),gr=Ir-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,Y[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,Y[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,Y[2]=pr-(_r-ur)+(dr-ur),Y[3]=_r,h=b(b(b(k(k(4,C,Fr,$),$,Fr,rr),rr,k(k(4,C,Ir,$),$,Ir,tr),tr,nr),nr,b(k(k(4,X,Ar,$),$,Ar,rr),rr,k(k(4,X,Er,$),$,Er,tr),tr,ar),ar,vr),vr,b(k(k(4,Y,Sr,$),$,Sr,rr),rr,k(k(4,Y,Tr,$),$,Tr,tr),tr,nr),nr,or);let qr=_(h,or),Cr=4440892098500632e-31*s;if(qr>=Cr||-qr>=Cr)return qr;if(ur=r-Fr,l=r-(Fr+ur)+(ur-v),ur=t-Ir,x=t-(Ir+ur)+(ur-o),ur=e-Ar,f=e-(Ar+ur)+(ur-v),ur=n-Er,y=n-(Er+ur)+(ur-o),ur=a-Sr,u=a-(Sr+ur)+(ur-v),ur=i-Tr,c=i-(Tr+ur)+(ur-o),0===l&&0===f&&0===u&&0===x&&0===y&&0===c)return qr;if(Cr=5423418723394464e-46*s+m*Math.abs(qr),qr+=(Fr*Fr+Ir*Ir)*(Ar*c+Tr*f-(Er*u+Sr*y))+2*(Fr*l+Ir*x)*(Ar*Tr-Er*Sr)+((Ar*Ar+Er*Er)*(Sr*x+Ir*u-(Tr*l+Fr*c))+2*(Ar*f+Er*y)*(Sr*Ir-Tr*Fr))+((Sr*Sr+Tr*Tr)*(Fr*y+Er*l-(Ir*f+Ar*x))+2*(Sr*u+Tr*c)*(Fr*Er-Ir*Ar)),qr>=Cr||-qr>=Cr)return qr;if(0===f&&0===y&&0===u&&0===c||(mr=Fr*Fr,xr=M*Fr,yr=xr-(xr-Fr),cr=Fr-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Ir*Ir,xr=M*Ir,yr=xr-(xr-Ir),cr=Ir-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,D[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,D[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,D[2]=pr-(_r-ur)+(dr-ur),D[3]=_r),0===u&&0===c&&0===l&&0===x||(mr=Ar*Ar,xr=M*Ar,yr=xr-(xr-Ar),cr=Ar-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Er*Er,xr=M*Er,yr=xr-(xr-Er),cr=Er-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,B[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,B[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,B[2]=pr-(_r-ur)+(dr-ur),B[3]=_r),0===l&&0===x&&0===f&&0===y||(mr=Sr*Sr,xr=M*Sr,yr=xr-(xr-Sr),cr=Sr-yr,br=cr*cr-(mr-yr*yr-(yr+yr)*cr),wr=Tr*Tr,xr=M*Tr,yr=xr-(xr-Tr),cr=Tr-yr,kr=cr*cr-(wr-yr*yr-(yr+yr)*cr),dr=br+kr,ur=dr-br,O[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,O[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,O[2]=pr-(_r-ur)+(dr-ur),O[3]=_r),0!==l&&(z=k(4,C,l,V),h=hr(h,w(k(z,V,2*Fr,rr),rr,k(k(4,O,l,$),$,Er,tr),tr,k(k(4,B,l,$),$,-Tr,er),er,nr,ir),ir)),0!==x&&(g=k(4,C,x,P),h=hr(h,w(k(g,P,2*Ir,rr),rr,k(k(4,B,x,$),$,Sr,tr),tr,k(k(4,O,x,$),$,-Ar,er),er,nr,ir),ir)),0!==f&&(d=k(4,X,f,j),h=hr(h,w(k(d,j,2*Ar,rr),rr,k(k(4,D,f,$),$,Tr,tr),tr,k(k(4,O,f,$),$,-Ir,er),er,nr,ir),ir)),0!==y&&(p=k(4,X,y,L),h=hr(h,w(k(p,L,2*Er,rr),rr,k(k(4,O,y,$),$,Fr,tr),tr,k(k(4,D,y,$),$,-Sr,er),er,nr,ir),ir)),0!==u&&(F=k(4,Y,u,K),h=hr(h,w(k(F,K,2*Sr,rr),rr,k(k(4,B,u,$),$,Ir,tr),tr,k(k(4,D,u,$),$,-Er,er),er,nr,ir),ir)),0!==c&&(A=k(4,Y,c,N),h=hr(h,w(k(A,N,2*Tr,rr),rr,k(k(4,D,c,$),$,Ar,tr),tr,k(k(4,B,c,$),$,-Fr,er),er,nr,ir),ir)),0!==l||0!==x){if(0!==f||0!==y||0!==u||0!==c?(mr=f*Tr,xr=M*f,yr=xr-(xr-f),cr=f-yr,xr=M*Tr,zr=xr-(xr-Tr),gr=Tr-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Ar*c,xr=M*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=M*c,zr=xr-(xr-c),gr=c-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,mr=u*-Er,xr=M*u,yr=xr-(xr-u),cr=u-yr,xr=M*-Er,zr=xr-(xr- -Er),gr=-Er-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Sr*-y,xr=M*Sr,yr=xr-(xr-Sr),cr=Sr-yr,xr=M*-y,zr=xr-(xr- -y),gr=-y-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,Z[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,Z[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,Z[2]=pr-(_r-ur)+(dr-ur),Z[3]=_r,I=b(4,U,4,Z,G),mr=f*c,xr=M*f,yr=xr-(xr-f),cr=f-yr,xr=M*c,zr=xr-(xr-c),gr=c-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=u*y,xr=M*u,yr=xr-(xr-u),cr=u-yr,xr=M*y,zr=xr-(xr-y),gr=y-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,J[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,J[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,J[2]=pr-(_r-ur)+(dr-ur),J[3]=_r,q=4):(G[0]=0,I=1,J[0]=0,q=1),0!==l){const r=k(I,G,l,er);h=hr(h,b(k(z,V,l,rr),rr,k(r,er,2*Fr,nr),nr,ir),ir);const t=k(q,J,l,$);h=hr(h,w(k(t,$,2*Fr,rr),rr,k(t,$,l,tr),tr,k(r,er,l,nr),nr,ar,vr),vr),0!==y&&(h=hr(h,k(k(4,O,l,$),$,y,rr),rr)),0!==c&&(h=hr(h,k(k(4,B,-l,$),$,c,rr),rr))}if(0!==x){const r=k(I,G,x,er);h=hr(h,b(k(g,P,x,rr),rr,k(r,er,2*Ir,nr),nr,ir),ir);const t=k(q,J,x,$);h=hr(h,w(k(t,$,2*Ir,rr),rr,k(t,$,x,tr),tr,k(r,er,x,nr),nr,ar,vr),vr)}}if(0!==f||0!==y){if(0!==u||0!==c||0!==l||0!==x?(mr=u*Ir,xr=M*u,yr=xr-(xr-u),cr=u-yr,xr=M*Ir,zr=xr-(xr-Ir),gr=Ir-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Sr*x,xr=M*Sr,yr=xr-(xr-Sr),cr=Sr-yr,xr=M*x,zr=xr-(xr-x),gr=x-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,lr=-Tr,fr=-c,mr=l*lr,xr=M*l,yr=xr-(xr-l),cr=l-yr,xr=M*lr,zr=xr-(xr-lr),gr=lr-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Fr*fr,xr=M*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=M*fr,zr=xr-(xr-fr),gr=fr-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,Z[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,Z[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,Z[2]=pr-(_r-ur)+(dr-ur),Z[3]=_r,E=b(4,U,4,Z,R),mr=u*x,xr=M*u,yr=xr-(xr-u),cr=u-yr,xr=M*x,zr=xr-(xr-x),gr=x-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=l*c,xr=M*l,yr=xr-(xr-l),cr=l-yr,xr=M*c,zr=xr-(xr-c),gr=c-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,Q[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,Q[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,Q[2]=pr-(_r-ur)+(dr-ur),Q[3]=_r,sr=4):(R[0]=0,E=1,Q[0]=0,sr=1),0!==f){const r=k(E,R,f,er);h=hr(h,b(k(d,j,f,rr),rr,k(r,er,2*Ar,nr),nr,ir),ir);const t=k(sr,Q,f,$);h=hr(h,w(k(t,$,2*Ar,rr),rr,k(t,$,f,tr),tr,k(r,er,f,nr),nr,ar,vr),vr),0!==c&&(h=hr(h,k(k(4,D,f,$),$,c,rr),rr)),0!==x&&(h=hr(h,k(k(4,O,-f,$),$,x,rr),rr))}if(0!==y){const r=k(E,R,y,er);h=hr(h,b(k(p,L,y,rr),rr,k(r,er,2*Er,nr),nr,ir),ir);const t=k(sr,Q,y,$);h=hr(h,w(k(t,$,2*Er,rr),rr,k(t,$,y,tr),tr,k(r,er,y,nr),nr,ar,vr),vr)}}if(0!==u||0!==c){if(0!==l||0!==x||0!==f||0!==y?(mr=l*Er,xr=M*l,yr=xr-(xr-l),cr=l-yr,xr=M*Er,zr=xr-(xr-Er),gr=Er-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Fr*y,xr=M*Fr,yr=xr-(xr-Fr),cr=Fr-yr,xr=M*y,zr=xr-(xr-y),gr=y-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,U[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,U[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,U[2]=pr-(_r-ur)+(dr-ur),U[3]=_r,lr=-Ir,fr=-x,mr=f*lr,xr=M*f,yr=xr-(xr-f),cr=f-yr,xr=M*lr,zr=xr-(xr-lr),gr=lr-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=Ar*fr,xr=M*Ar,yr=xr-(xr-Ar),cr=Ar-yr,xr=M*fr,zr=xr-(xr-fr),gr=fr-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br+kr,ur=dr-br,Z[0]=br-(dr-ur)+(kr-ur),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr+wr,ur=dr-Mr,Z[1]=Mr-(dr-ur)+(wr-ur),_r=pr+dr,ur=_r-pr,Z[2]=pr-(_r-ur)+(dr-ur),Z[3]=_r,S=b(4,U,4,Z,W),mr=l*y,xr=M*l,yr=xr-(xr-l),cr=l-yr,xr=M*y,zr=xr-(xr-y),gr=y-zr,br=cr*gr-(mr-yr*zr-cr*zr-yr*gr),wr=f*x,xr=M*f,yr=xr-(xr-f),cr=f-yr,xr=M*x,zr=xr-(xr-x),gr=x-zr,kr=cr*gr-(wr-yr*zr-cr*zr-yr*gr),dr=br-kr,ur=br-dr,H[0]=br-(dr+ur)+(ur-kr),pr=mr+dr,ur=pr-mr,Mr=mr-(pr-ur)+(dr-ur),dr=Mr-wr,ur=Mr-dr,H[1]=Mr-(dr+ur)+(ur-wr),_r=pr+dr,ur=_r-pr,H[2]=pr-(_r-ur)+(dr-ur),H[3]=_r,T=4):(W[0]=0,S=1,H[0]=0,T=1),0!==u){const r=k(S,W,u,er);h=hr(h,b(k(F,K,u,rr),rr,k(r,er,2*Sr,nr),nr,ir),ir);const t=k(T,H,u,$);h=hr(h,w(k(t,$,2*Sr,rr),rr,k(t,$,u,tr),tr,k(r,er,u,nr),nr,ar,vr),vr),0!==x&&(h=hr(h,k(k(4,B,u,$),$,x,rr),rr)),0!==y&&(h=hr(h,k(k(4,D,-u,$),$,y,rr),rr))}if(0!==c){const r=k(S,W,c,er);h=hr(h,b(k(A,N,c,rr),rr,k(r,er,2*Tr,nr),nr,ir),ir);const t=k(T,H,c,$);h=hr(h,w(k(t,$,2*Tr,rr),rr,k(t,$,c,tr),tr,k(r,er,c,nr),nr,ar,vr),vr)}}return or[h-1]}(r,t,e,n,a,i,v,o,E)}const fr=Math.pow(2,-52),ur=new Uint32Array(512);class xr{static from(r,t=pr,e=Mr){const n=r.length,a=new Float64Array(2*n);for(let i=0;i<n;i++){const n=r[i];a[2*i]=t(n),a[2*i+1]=e(n)}return new xr(a)}constructor(r){const t=r.length>>1;if(t>0&&"number"!=typeof r[0])throw new Error("Expected coords to contain numbers.");this.coords=r;const e=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*e),this._halfedges=new Int32Array(3*e),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:r,_hullPrev:t,_hullNext:e,_hullTri:n,_hullHash:a}=this,i=r.length>>1;let v=1/0,o=1/0,s=-1/0,h=-1/0;for(let t=0;t<i;t++){const e=r[2*t],n=r[2*t+1];e<v&&(v=e),n<o&&(o=n),e>s&&(s=e),n>h&&(h=n),this._ids[t]=t}const l=(v+s)/2,f=(o+h)/2;let u,x,y;for(let t=0,e=1/0;t<i;t++){const n=yr(l,f,r[2*t],r[2*t+1]);n<e&&(u=t,e=n)}const c=r[2*u],z=r[2*u+1];for(let t=0,e=1/0;t<i;t++){if(t===u)continue;const n=yr(c,z,r[2*t],r[2*t+1]);n<e&&n>0&&(x=t,e=n)}let g=r[2*x],d=r[2*x+1],p=1/0;for(let t=0;t<i;t++){if(t===u||t===x)continue;const e=zr(c,z,g,d,r[2*t],r[2*t+1]);e<p&&(y=t,p=e)}let M=r[2*y],m=r[2*y+1];if(p===1/0){for(let t=0;t<i;t++)this._dists[t]=r[2*t]-r[0]||r[2*t+1]-r[1];gr(this._ids,this._dists,0,i-1);const t=new Uint32Array(i);let e=0;for(let r=0,n=-1/0;r<i;r++){const a=this._ids[r],i=this._dists[a];i>n&&(t[e++]=a,n=i)}return this.hull=t.subarray(0,e),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(q(c,z,g,d,M,m)<0){const r=x,t=g,e=d;x=y,g=M,d=m,y=r,M=t,m=e}const b=function(r,t,e,n,a,i){const v=e-r,o=n-t,s=a-r,h=i-t,l=v*v+o*o,f=s*s+h*h,u=.5/(v*h-o*s);return{x:r+(h*l-o*f)*u,y:t+(v*f-s*l)*u}}(c,z,g,d,M,m);this._cx=b.x,this._cy=b.y;for(let t=0;t<i;t++)this._dists[t]=yr(r[2*t],r[2*t+1],b.x,b.y);gr(this._ids,this._dists,0,i-1),this._hullStart=u;let w=3;e[u]=t[y]=x,e[x]=t[u]=y,e[y]=t[x]=u,n[u]=0,n[x]=1,n[y]=2,a.fill(-1),a[this._hashKey(c,z)]=u,a[this._hashKey(g,d)]=x,a[this._hashKey(M,m)]=y,this.trianglesLen=0,this._addTriangle(u,x,y,-1,-1,-1);for(let i,v,o=0;o<this._ids.length;o++){const s=this._ids[o],h=r[2*s],l=r[2*s+1];if(o>0&&Math.abs(h-i)<=fr&&Math.abs(l-v)<=fr)continue;if(i=h,v=l,s===u||s===x||s===y)continue;let f=0;for(let r=0,t=this._hashKey(h,l);r<this._hashSize&&(f=a[(t+r)%this._hashSize],-1===f||f===e[f]);r++);f=t[f];let c,z=f;for(;c=e[z],q(h,l,r[2*z],r[2*z+1],r[2*c],r[2*c+1])>=0;)if(z=c,z===f){z=-1;break}if(-1===z)continue;let g=this._addTriangle(z,s,e[z],-1,-1,n[z]);n[s]=this._legalize(g+2),n[z]=g,w++;let d=e[z];for(;c=e[d],q(h,l,r[2*d],r[2*d+1],r[2*c],r[2*c+1])<0;)g=this._addTriangle(d,s,c,n[s],-1,n[d]),n[s]=this._legalize(g+2),e[d]=d,w--,d=c;if(z===f)for(;c=t[z],q(h,l,r[2*c],r[2*c+1],r[2*z],r[2*z+1])<0;)g=this._addTriangle(c,s,z,-1,n[z],n[c]),this._legalize(g+2),n[c]=g,e[z]=z,w--,z=c;this._hullStart=t[s]=z,e[z]=t[d]=s,e[s]=d,a[this._hashKey(h,l)]=s,a[this._hashKey(r[2*z],r[2*z+1])]=z}this.hull=new Uint32Array(w);for(let r=0,t=this._hullStart;r<w;r++)this.hull[r]=t,t=e[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(r,t){return Math.floor(function(r,t){const e=r/(Math.abs(r)+Math.abs(t));return(t>0?3-e:1+e)/4}(r-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(r){const{_triangles:t,_halfedges:e,coords:n}=this;let a=0,i=0;for(;;){const v=e[r],o=r-r%3;if(i=o+(r+2)%3,-1===v){if(0===a)break;r=ur[--a];continue}const s=v-v%3,h=o+(r+1)%3,l=s+(v+2)%3,f=t[i],u=t[r],x=t[h],y=t[l];if(cr(n[2*f],n[2*f+1],n[2*u],n[2*u+1],n[2*x],n[2*x+1],n[2*y],n[2*y+1])){t[r]=y,t[v]=f;const n=e[l];if(-1===n){let t=this._hullStart;do{if(this._hullTri[t]===l){this._hullTri[t]=r;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(r,n),this._link(v,e[i]),this._link(i,l);const o=s+(v+1)%3;a<ur.length&&(ur[a++]=o)}else{if(0===a)break;r=ur[--a]}}return i}_link(r,t){this._halfedges[r]=t,-1!==t&&(this._halfedges[t]=r)}_addTriangle(r,t,e,n,a,i){const v=this.trianglesLen;return this._triangles[v]=r,this._triangles[v+1]=t,this._triangles[v+2]=e,this._link(v,n),this._link(v+1,a),this._link(v+2,i),this.trianglesLen+=3,v}}function yr(r,t,e,n){const a=r-e,i=t-n;return a*a+i*i}function cr(r,t,e,n,a,i,v,o){const s=r-v,h=t-o,l=e-v,f=n-o,u=a-v,x=i-o,y=l*l+f*f,c=u*u+x*x;return s*(f*c-y*x)-h*(l*c-y*u)+(s*s+h*h)*(l*x-f*u)<0}function zr(r,t,e,n,a,i){const v=e-r,o=n-t,s=a-r,h=i-t,l=v*v+o*o,f=s*s+h*h,u=.5/(v*h-o*s),x=(h*l-o*f)*u,y=(v*f-s*l)*u;return x*x+y*y}function gr(r,t,e,n){if(n-e<=20)for(let a=e+1;a<=n;a++){const n=r[a],i=t[n];let v=a-1;for(;v>=e&&t[r[v]]>i;)r[v+1]=r[v--];r[v+1]=n}else{let a=e+1,i=n;dr(r,e+n>>1,a),t[r[e]]>t[r[n]]&&dr(r,e,n),t[r[a]]>t[r[n]]&&dr(r,a,n),t[r[e]]>t[r[a]]&&dr(r,e,a);const v=r[a],o=t[v];for(;;){do{a++}while(t[r[a]]<o);do{i--}while(t[r[i]]>o);if(i<a)break;dr(r,a,i)}r[e+1]=r[i],r[i]=v,n-a+1>=i-e?(gr(r,t,a,n),gr(r,t,e,i-1)):(gr(r,t,e,i-1),gr(r,t,a,n))}}function dr(r,t,e){const n=r[t];r[t]=r[e],r[e]=n}function pr(r){return r[0]}function Mr(r){return r[1]}class mr{constructor(r,t){this.W=r,this.bs=t}add(r){const t=this.W,e=r/t|0,n=r%t;return this.bs[e]|=1<<n,this}delete(r){const t=this.W,e=r/t|0,n=r%t;return this.bs[e]&=~(1<<n),this}set(r,t){const e=this.W,n=r/e|0,a=1<<r%e;return this.bs[n]^=(-t^this.bs[n])&a,t}has(r){const t=this.W,e=r/t|0,n=r%t;return!!(this.bs[e]&1<<n)}forEach(r){const t=this.W,e=this.bs,n=e.length;for(let a=0;a<n;a++){let n=0;for(;e[a]&&n<t;)e[a]&1<<n&&r(a*t+n),n++}return this}}class br extends mr{constructor(r){super(8,new Uint8Array(Math.ceil(r/8)).fill(0))}}function wr(r){return r%3==2?r-2:r+1}function kr(r){return r%3==0?r+2:r-1}class _r{constructor(r,t){if(!(r&&"object"==typeof r&&r.triangles&&r.halfedges&&r.coords))throw new Error("Expected an object with Delaunator output");if(r.triangles.length%3||r.halfedges.length!==r.triangles.length||r.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(r.triangles.length<3)throw new Error("No edges in triangulation");this.del=r;const e=2**32-1,n=r.coords.length>>1,a=r.triangles.length;this.vertMap=new Uint32Array(n).fill(e),this.flips=new br(a),this.consd=new br(a);for(let t=0;t<a;t++){const n=r.triangles[t];this.vertMap[n]===e&&this.updateVert(t)}t&&this.constrainAll(t)}constrainOne(r,t){const{triangles:e,halfedges:n}=this.del,a=this.vertMap,i=this.consd,v=a[r];let o=v;do{const a=e[o],i=wr(o);if(a===t)return this.protect(o);const v=kr(o),s=e[v];if(s===t)return this.protect(i),i;if(this.intersectSegments(r,t,s,a)){o=v;break}o=n[i]}while(-1!==o&&o!==v);let s=o,h=-1;for(;-1!==o;){const a=n[o],v=kr(o),l=kr(a),f=wr(a);if(-1===a)throw new Error("Constraining edge exited the hull");if(i.has(o))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(r,t,e[o])||this.isCollinear(r,t,e[a]))throw new Error("Constraining edge intersects point");if(this.intersectSegments(e[o],e[a],e[v],e[l])){if(this.flipDiagonal(o),this.intersectSegments(r,t,e[v],e[l])&&(-1===h&&(h=v),h===v))throw new Error("Infinite loop: flipped diagonal still intersects");e[l]===t?(s=l,o=h,h=-1):this.intersectSegments(r,t,e[f],e[l])&&(o=f)}else{if(-1===h&&(h=o),e[l]===t){if(o===h)throw new Error("Infinite loop: non-convex quadrilateral");o=h,h=-1;continue}if(this.intersectSegments(r,t,e[l],e[a]))o=l;else if(this.intersectSegments(r,t,e[f],e[l]))o=f;else if(h===o)throw new Error("Infinite loop: no further intersect after non-convex")}}const l=this.flips;this.protect(s);do{var f=0;l.forEach(r=>{l.delete(r);const t=n[r];-1!==t&&(l.delete(t),this.isDelaunay(r)||(this.flipDiagonal(r),f++))})}while(f>0);return this.findEdge(r,t)}delaunify(r=!1){const t=this.del.halfedges,e=this.flips,n=this.consd,a=t.length;do{var i=0;for(let r=0;r<a;r++){if(n.has(r))continue;e.delete(r);const a=t[r];-1!==a&&(e.delete(a),this.isDelaunay(r)||(this.flipDiagonal(r),i++))}}while(r&&i>0);return this}constrainAll(r){const t=r.length;for(let e=0;e<t;e++){const t=r[e];this.constrainOne(t[0],t[1])}return this}isConstrained(r){return this.consd.has(r)}findEdge(r,t){const e=this.vertMap[t],{triangles:n,halfedges:a}=this.del;let i=e,v=-1;do{if(n[i]===r)return i;v=wr(i),i=a[v]}while(-1!==i&&i!==e);return n[wr(v)]===r?-v:1/0}protect(r){const t=this.del.halfedges[r],e=this.flips,n=this.consd;return e.delete(r),n.add(r),-1!==t?(e.delete(t),n.add(t),t):-r}markFlip(r){const t=this.del.halfedges,e=this.flips;if(this.consd.has(r))return!1;const n=t[r];return-1!==n&&(e.add(r),e.add(n)),!0}flipDiagonal(r){const{triangles:t,halfedges:e}=this.del,n=this.flips,a=this.consd,i=e[r],v=kr(r),o=wr(r),s=kr(i),h=wr(i),l=e[v],f=e[s];if(a.has(r))throw new Error("Trying to flip a constrained edge");return t[r]=t[s],e[r]=f,n.set(r,n.has(s))||a.set(r,a.has(s)),-1!==f&&(e[f]=r),e[v]=s,t[i]=t[v],e[i]=l,n.set(i,n.has(v))||a.set(i,a.has(v)),-1!==l&&(e[l]=i),e[s]=v,this.markFlip(r),this.markFlip(o),this.markFlip(i),this.markFlip(h),n.add(v),a.delete(v),n.add(s),a.delete(s),this.updateVert(r),this.updateVert(o),this.updateVert(i),this.updateVert(h),v}isDelaunay(r){const{triangles:t,halfedges:e}=this.del,n=e[r];if(-1===n)return!0;const a=t[kr(r)],i=t[r],v=t[wr(r)],o=t[kr(n)];return!this.inCircle(a,i,v,o)}updateVert(r){const{triangles:t,halfedges:e}=this.del,n=this.vertMap,a=t[r];let i=kr(r),v=e[i];for(;-1!==v&&v!==r;)i=kr(v),v=e[i];return n[a]=i,i}intersectSegments(r,t,e,n){const a=this.del.coords;return r!==e&&r!==n&&t!==e&&t!==n&&Fr(a[2*r],a[2*r+1],a[2*t],a[2*t+1],a[2*e],a[2*e+1],a[2*n],a[2*n+1])}inCircle(r,t,e,n){const a=this.del.coords;return lr(a[2*r],a[2*r+1],a[2*t],a[2*t+1],a[2*e],a[2*e+1],a[2*n],a[2*n+1])<0}isCollinear(r,t,e){const n=this.del.coords;return 0===q(n[2*r],n[2*r+1],n[2*t],n[2*t+1],n[2*e],n[2*e+1])}}function Fr(r,t,e,n,a,i,v,o){const s=q(r,t,a,i,v,o),h=q(e,n,a,i,v,o);if(s>0&&h>0||s<0&&h<0)return!1;const l=q(a,i,r,t,e,n),f=q(v,o,r,t,e,n);return!(l>0&&f>0||l<0&&f<0)&&(0!==s||0!==h||0!==l||0!==f||!(Math.max(a,v)<Math.min(r,e)||Math.max(r,e)<Math.min(a,v)||Math.max(i,o)<Math.min(t,n)||Math.max(t,n)<Math.min(i,o)))}function Ar(r,t){if(!t||0===t.length)return[r];var e=r.v1.x-r.v0.x,n=r.v1.y-r.v0.y,a=r.v1.z-r.v0.z,i=r.v2.x-r.v0.x,v=r.v2.y-r.v0.y,o=r.v2.z-r.v0.z,s=Math.sqrt(e*e+n*n+a*a);if(s<1e-12)return[r];var h=e/s,l=n/s,f=a/s,u=n*o-a*v,x=a*i-e*o,y=e*v-n*i;if(Math.sqrt(u*u+x*x+y*y)<1e-12)return[r];var c=x*f-y*l,z=y*h-u*f,g=u*l-x*h,d=Math.sqrt(c*c+z*z+g*g);if(d<1e-12)return[r];c/=d,z/=d,g/=d;var p=r.v0.x,M=r.v0.y,m=r.v0.z;function b(r){var t=r.x-p,e=r.y-M,n=r.z-m;return[t*h+e*l+n*f,t*c+e*z+n*g]}var w=b(r.v0),k=b(r.v1),_=b(r.v2),F=(k[1]-_[1])*(w[0]-_[0])+(_[0]-k[0])*(w[1]-_[1]);if(Math.abs(F)<1e-12)return[r];function A(r,t){var e=((k[1]-_[1])*(r-_[0])+(_[0]-k[0])*(t-_[1]))/F,n=((_[1]-w[1])*(r-_[0])+(w[0]-_[0])*(t-_[1]))/F;return[e,n,1-e-n]}var S=.5*Math.abs(F),I={},E=r.v0.x.toFixed(6)+","+r.v0.y.toFixed(6)+","+r.v0.z.toFixed(6),T=r.v1.x.toFixed(6)+","+r.v1.y.toFixed(6)+","+r.v1.z.toFixed(6),q=r.v2.x.toFixed(6)+","+r.v2.y.toFixed(6)+","+r.v2.z.toFixed(6);I[E]=!0,I[T]=!0,I[q]=!0;var C=-1e-4,X=[],Y={};Y[E]=0,Y[T]=1,Y[q]=2;for(var D=0;D<t.length;D++)for(var B=t[D],O=[B.p0,B.p1],U=0;U<2;U++){var Z=O[U],V=Z.x.toFixed(6)+","+Z.y.toFixed(6)+","+Z.z.toFixed(6);if(!I[V]){I[V]=!0;var P=b(Z),j=A(P[0],P[1]);j[0]<C||j[1]<C||j[2]<C||X.push({x:Z.x,y:Z.y,z:Z.z,key:V})}}if(0===X.length)return[r];for(var L=[{x:r.v0.x,y:r.v0.y,z:r.v0.z},{x:r.v1.x,y:r.v1.y,z:r.v1.z},{x:r.v2.x,y:r.v2.y,z:r.v2.z}],K=0;K<X.length;K++)Y[X[K].key]=L.length,L.push(X[K]);for(var N,W=L.length,G=new Float64Array(2*W),R=0;R<W;R++){var H=b(L[R]);G[2*R]=H[0],G[2*R+1]=H[1]}try{N=new xr(G)}catch(t){return[r]}try{for(var J=new _r(N),Q=0;Q<t.length;Q++){var $=t[Q],rr=$.p0.x.toFixed(6)+","+$.p0.y.toFixed(6)+","+$.p0.z.toFixed(6),tr=$.p1.x.toFixed(6)+","+$.p1.y.toFixed(6)+","+$.p1.z.toFixed(6),er=Y[rr],nr=Y[tr];if(void 0!==er&&void 0!==nr&&er!==nr)try{J.constrainOne(er,nr)}catch(r){}}}catch(r){}for(var ar=[],ir=N.triangles,vr=0;vr<ir.length;vr+=3){var or=ir[vr],sr=ir[vr+1],hr=ir[vr+2],lr=A((G[2*or]+G[2*sr]+G[2*hr])/3,(G[2*or+1]+G[2*sr+1]+G[2*hr+1])/3);if(!(lr[0]<-1e-6||lr[1]<-1e-6||lr[2]<-1e-6)){var fr=G[2*or],ur=G[2*or+1],yr=G[2*sr],cr=G[2*sr+1],zr=G[2*hr],gr=G[2*hr+1];.5*Math.abs((yr-fr)*(gr-ur)-(zr-fr)*(cr-ur))<1e-8*S||ar.push({v0:L[or],v1:L[sr],v2:L[hr]})}}return 0===ar.length?[r]:ar}_r.intersectSegments=Fr;var Sr={z:[{da:537e-7,db:241e-7},{da:-319e-7,db:673e-7},{da:157e-7,db:-489e-7}],x:[{da:443e-7,db:-317e-7},{da:-261e-7,db:559e-7},{da:189e-7,db:371e-7}],y:[{da:-397e-7,db:283e-7},{da:521e-7,db:-447e-7},{da:-173e-7,db:613e-7}]};function Ir(r,t,e,n,a,i){for(var v=0,o=0;o<n.length;o++){var s,h,l,f,u,x,y,c,z,g=a[n[o]];"z"===i?(s=g.v0.x,h=g.v0.y,l=g.v0.z,f=g.v1.x,u=g.v1.y,x=g.v1.z,y=g.v2.x,c=g.v2.y,z=g.v2.z):"x"===i?(s=g.v0.y,h=g.v0.z,l=g.v0.x,f=g.v1.y,u=g.v1.z,x=g.v1.x,y=g.v2.y,c=g.v2.z,z=g.v2.x):(s=g.v0.x,h=g.v0.z,l=g.v0.y,f=g.v1.x,u=g.v1.z,x=g.v1.y,y=g.v2.x,c=g.v2.z,z=g.v2.y);var d=(u-c)*(s-y)+(y-f)*(h-c);if(!(Math.abs(d)<1e-12)){var p=((u-c)*(r-y)+(y-f)*(t-c))/d,M=((c-h)*(r-y)+(s-y)*(t-c))/d,m=1-p-M;if(!(p<-1e-10||M<-1e-10||m<-1e-10))p*l+M*x+m*z>e&&v++}}return v}function Er(r,t,e,n,a){var i,v,o;"z"===a?(i=r.x,v=r.y,o=r.z):"x"===a?(i=r.y,v=r.z,o=r.x):(i=r.x,v=r.z,o=r.y);for(var s=Sr[a],h=0,l=0,f=0;f<3;f++){var u=i+s[f].da,y=v+s[f].db,z=Ir(u,y,o,"z"===a?c(e,{minX:u,maxX:u,minY:y,maxY:y},n):x(e,u,y,n),t,a);z>0&&l++,z%2==1&&h++}return 0===l?0:h>=2?1:2}function Tr(r,t,e){var n=Er(r,t,e.xy.grid,e.xy.cellSize,"z"),a=Er(r,t,e.yz.grid,e.yz.cellSize,"x"),i=Er(r,t,e.xz.grid,e.xz.cellSize,"y"),v=0,o=0;return 1===n?v++:2===n&&o++,1===a?v++:2===a&&o++,1===i?v++:2===i&&o++,v>=2?1:o>=1?-1:1===v?1:-1}function qr(r,t,e,n){var a=r.length,i=new Int8Array(a);function v(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var o={},s=0;s<a;s++)if(!t[s])for(var h=r[s],l=v(h.v0),f=v(h.v1),u=v(h.v2),x=[l<f?l+"|"+f:f+"|"+l,f<u?f+"|"+u:u+"|"+f,u<l?u+"|"+l:l+"|"+u],y=0;y<3;y++)o[x[y]]||(o[x[y]]=[]),o[x[y]].push(s);for(var c=new Array(a),z=0;z<a;z++)c[z]=[];for(var g in o)for(var d=o[g],p=0;p<d.length;p++)for(var M=p+1;M<d.length;M++)c[d[p]].push(d[M]),c[d[M]].push(d[p]);for(var m=new Uint8Array(a),b=0;b<a;b++)if(!m[b]&&!t[b]){var w=r[b],k=Tr({x:(w.v0.x+w.v1.x+w.v2.x)/3,y:(w.v0.y+w.v1.y+w.v2.y)/3,z:(w.v0.z+w.v1.z+w.v2.z)/3},e,n),_=[b];m[b]=1,i[b]=k;for(var F=0;F<_.length;)for(var A=c[_[F++]],S=0;S<A.length;S++){var I=A[S];m[I]||(m[I]=1,i[I]=k,_.push(I))}}return i}function Cr(r,t,e,n,a){var i=[],v=[];function o(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var s={},h=0;h<r.length;h++)if(!e[h])for(var l=t[h],f=r[h],u=[f.v0,f.v1,f.v2],x=0;x<3;x++){var y=o(u[x]);void 0===s[y]&&(s[y]=l)}var c={};for(var z in e)for(var g=e[z],d=0;d<g.length;d++)c[o(g[d].p0)]=!0,c[o(g[d].p1)]=!0;for(var p=0;p<r.length;p++)if(e[p])for(var M=e[p],m=Ar(r[p],M),b=0;b<m.length;b++){for(var w=m[b],k=[w.v0,w.v1,w.v2],_=0,F=0;F<3;F++){var A=o(k[F]);if(!c[A]){var S=s[A];if(void 0!==S){_=S;break}}}if(0===_)_=Tr({x:(w.v0.x+w.v1.x+w.v2.x)/3,y:(w.v0.y+w.v1.y+w.v2.y)/3,z:(w.v0.z+w.v1.z+w.v2.z)/3},n,a);1===_?i.push(w):v.push(w)}else 1===t[p]?i.push(r[p]):v.push(r[p]);return{inside:i,outside:v}}function Xr(r,t){if(!r||0===r.length)return r;void 0===t&&(t=1e-4);var e=1/(3*t),n={};function a(r,a,i){for(var v=Math.floor(r*e),o=Math.floor(a*e),s=Math.floor(i*e),h=t*t,l=null,f=-1;f<=1;f++)for(var u=-1;u<=1;u++)for(var x=-1;x<=1;x++){var y=n[v+f+","+(o+u)+","+(s+x)];if(y)for(var c=0;c<y.length;c++){var z=y[c],g=z.x-r,d=z.y-a,p=z.z-i,M=g*g+d*d+p*p;M<h&&(h=M,l=z)}}if(l)return l;var m,b,w,k={x:r,y:a,z:i},_=(m=r,b=a,w=i,Math.floor(m*e)+","+Math.floor(b*e)+","+Math.floor(w*e));return n[_]||(n[_]=[]),n[_].push(k),k}for(var i=[],v=0;v<r.length;v++){var o=r[v],s=a(o.v0.x,o.v0.y,o.v0.z),h=a(o.v1.x,o.v1.y,o.v1.z),l=a(o.v2.x,o.v2.y,o.v2.z);s!==h&&h!==l&&l!==s&&i.push({v0:s,v1:h,v2:l})}return i}function Yr(r,t){var e=[],n=[];if(t<=0){for(var a=0;a<r.length;a++){var i=r[a];e.push({x:i.v0.x,y:i.v0.y,z:i.v0.z},{x:i.v1.x,y:i.v1.y,z:i.v1.z},{x:i.v2.x,y:i.v2.y,z:i.v2.z}),n.push({vertices:[{x:i.v0.x,y:i.v0.y,z:i.v0.z},{x:i.v1.x,y:i.v1.y,z:i.v1.z},{x:i.v2.x,y:i.v2.y,z:i.v2.z}]})}return{points:e,triangles:n}}var v=Math.max(2*t,.002),o={},s=t*t;function h(r){for(var t=Math.floor(r.x/v),n=Math.floor(r.y/v),a=Math.floor(r.z/v),i=-1;i<=1;i++)for(var h=-1;h<=1;h++)for(var l=-1;l<=1;l++){var f=o[t+i+","+(n+h)+","+(a+l)];if(f)for(var u=0;u<f.length;u++){var x=e[f[u]],y=x.x-r.x,c=x.y-r.y,z=x.z-r.z;if(y*y+c*c+z*z<=s)return f[u]}}var g=e.length;e.push({x:r.x,y:r.y,z:r.z});var d=t+","+n+","+a;return o[d]||(o[d]=[]),o[d].push(g),g}for(var l=0;l<r.length;l++){var f=r[l],u=h(f.v0),x=h(f.v1),y=h(f.v2);u!==x&&x!==y&&u!==y&&n.push({vertices:[{x:e[u].x,y:e[u].y,z:e[u].z},{x:e[x].x,y:e[x].y,z:e[x].z},{x:e[y].x,y:e[y].y,z:e[y].z}]})}return{points:e,triangles:n}}function Dr(r){for(var t=[],e=0;e<r.length;e++){var n=r[e].vertices;t.push({v0:{x:n[0].x,y:n[0].y,z:n[0].z},v1:{x:n[1].x,y:n[1].y,z:n[1].z},v2:{x:n[2].x,y:n[2].y,z:n[2].z}})}return t}function Br(r){for(var t=[],e=0;e<r.length;e++){var n=r[e],a={x:n.v0.x,y:n.v0.y,z:n.v0.z},i={x:n.v1.x,y:n.v1.y,z:n.v1.z},v={x:n.v2.x,y:n.v2.y,z:n.v2.z};s({v0:a,v1:i,v2:v}).z<-.01?t.push({v0:a,v1:v,v2:i}):t.push({v0:a,v1:i,v2:v})}return t}function Or(r){if(0===r.length)return r;function t(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var e={},n=0;n<r.length;n++)for(var a=r[n],i=t(a.v0),v=t(a.v1),o=t(a.v2),s=[{from:i,to:v},{from:v,to:o},{from:o,to:i}],h=0;h<3;h++){var l=s[h].from<s[h].to?s[h].from+"|"+s[h].to:s[h].to+"|"+s[h].from;e[l]||(e[l]=[]),e[l].push({triIdx:n,from:s[h].from,to:s[h].to})}var f=!0;for(var u in e)if(2!==e[u].length){f=!1;break}if(!f)return Br(r);for(var x=new Array(r.length),y=0;y<r.length;y++)x[y]=[];for(var c in e){var z=e[c];if(2===z.length){var g=z[0],d=z[1];x[g.triIdx].push({neighbor:d.triIdx,sameDirection:g.from===d.from}),x[d.triIdx].push({neighbor:g.triIdx,sameDirection:g.from===d.from})}}var p=new Uint8Array(r.length),M=new Uint8Array(r.length);M[0]=1;for(var m=[0],b=0;b<m.length;)for(var w=m[b++],k=x[w],_=0;_<k.length;_++){var F=k[_];if(!M[F.neighbor]){M[F.neighbor]=1;var A=p[w];F.sameDirection?p[F.neighbor]=A?0:1:p[F.neighbor]=A,m.push(F.neighbor)}}for(var S=[],I=0;I<r.length;I++){var E=r[I];p[I]?S.push({v0:{x:E.v0.x,y:E.v0.y,z:E.v0.z},v1:{x:E.v2.x,y:E.v2.y,z:E.v2.z},v2:{x:E.v1.x,y:E.v1.y,z:E.v1.z}}):S.push({v0:{x:E.v0.x,y:E.v0.y,z:E.v0.z},v1:{x:E.v1.x,y:E.v1.y,z:E.v1.z},v2:{x:E.v2.x,y:E.v2.y,z:E.v2.z}})}return S}function Ur(r,t){if(!t||0===t.length)return[r];var e=r.v1.x-r.v0.x,n=r.v1.y-r.v0.y,a=r.v1.z-r.v0.z,i=r.v2.x-r.v0.x,v=r.v2.y-r.v0.y,o=r.v2.z-r.v0.z,s=Math.sqrt(e*e+n*n+a*a);if(s<1e-12)return[r];var h=e/s,l=n/s,f=a/s,u=n*o-a*v,x=a*i-e*o,y=e*v-n*i;if(Math.sqrt(u*u+x*x+y*y)<1e-12)return[r];var c=x*f-y*l,z=y*h-u*f,g=u*l-x*h,d=Math.sqrt(c*c+z*z+g*g);if(d<1e-12)return[r];c/=d,z/=d,g/=d;var p=r.v0.x,M=r.v0.y,m=r.v0.z;function b(r){var t=r.x-p,e=r.y-M,n=r.z-m;return[t*h+e*l+n*f,t*c+e*z+n*g]}var w=b(r.v0),k=b(r.v1),_=b(r.v2),F=(k[1]-_[1])*(w[0]-_[0])+(_[0]-k[0])*(w[1]-_[1]);if(Math.abs(F)<1e-12)return[r];function A(r,t){var e=((k[1]-_[1])*(r-_[0])+(_[0]-k[0])*(t-_[1]))/F,n=((_[1]-w[1])*(r-_[0])+(w[0]-_[0])*(t-_[1]))/F;return[e,n,1-e-n]}for(var S=.5*Math.abs(F),I=[{x:r.v0.x,y:r.v0.y,z:r.v0.z},{x:r.v1.x,y:r.v1.y,z:r.v1.z},{x:r.v2.x,y:r.v2.y,z:r.v2.z}],E=0;E<t.length;E++)I.push(t[E]);for(var T,q=I.length,C=new Float64Array(2*q),X=0;X<q;X++){var Y=b(I[X]);C[2*X]=Y[0],C[2*X+1]=Y[1]}try{T=new xr(C)}catch(t){return[r]}for(var D=[],B=T.triangles,O=0;O<B.length;O+=3){var U=B[O],Z=B[O+1],V=B[O+2],P=A((C[2*U]+C[2*Z]+C[2*V])/3,(C[2*U+1]+C[2*Z+1]+C[2*V+1])/3);if(!(P[0]<-1e-6||P[1]<-1e-6||P[2]<-1e-6)){var j=C[2*U],L=C[2*U+1],K=C[2*Z],N=C[2*Z+1],W=C[2*V],G=C[2*V+1];.5*Math.abs((K-j)*(G-L)-(W-j)*(N-L))<1e-8*S||D.push({v0:I[U],v1:I[Z],v2:I[V]})}}return 0===D.length?[r]:D}function Zr(r,e,n){if(!r||0===r.length)return r;e||(e=1e-4),n||(n=3);function a(r){return r.x.toFixed(6)+","+r.y.toFixed(6)+","+r.z.toFixed(6)}for(var i=0,v=0,o=0;o<Math.min(r.length,200);o++){var s=r[o];i+=t(s.v0,s.v1)+t(s.v1,s.v2)+t(s.v2,s.v0),v+=3}for(var h=v>0?i/v:1,l=0;l<n;l++){for(var f=Math.max(h,100*e,.1),u=1/f,x={},y={},c=0;c<r.length;c++)for(var z=r[c],g=[z.v0,z.v1,z.v2],d=0;d<3;d++){var p=g[d],M=a(p);if(!y[M]){y[M]=!0;var m=Math.floor(p.x*u)+","+Math.floor(p.y*u)+","+Math.floor(p.z*u);x[m]||(x[m]=[]),x[m].push(p)}}for(var b=[],w=0,k=e*e,_=0;_<r.length;_++){for(var F=r[_],A=[F.v0,F.v1,F.v2],S=[a(A[0]),a(A[1]),a(A[2])],I=null,E=0;E<3;E++){var T=A[E],q=A[(E+1)%3],C=q.x-T.x,X=q.y-T.y,Y=q.z-T.z,D=C*C+X*X+Y*Y;if(!(D<1e-20)){var B=Math.sqrt(D),O=e/B;if(!(O>=.5))for(var U={},Z=Math.ceil(B/f)+1,V=0;V<=Z;V++)for(var P=V/Z,j=T.x+P*C,L=T.y+P*X,K=T.z+P*Y,N=Math.floor(j*u),W=Math.floor(L*u),G=Math.floor(K*u),R=-1;R<=1;R++)for(var H=-1;H<=1;H++)for(var J=-1;J<=1;J++){var Q=N+R+","+(W+H)+","+(G+J);if(!U[Q]){U[Q]=!0;var $=x[Q];if($)for(var rr=0;rr<$.length;rr++){var tr=$[rr],er=a(tr);if(er!==S[0]&&er!==S[1]&&er!==S[2]){var nr=((tr.x-T.x)*C+(tr.y-T.y)*X+(tr.z-T.z)*Y)/D;if(!(nr<=O||nr>=1-O)){var ar=T.x+nr*C,ir=T.y+nr*X,vr=T.z+nr*Y,or=tr.x-ar,sr=tr.y-ir,hr=tr.z-vr;or*or+sr*sr+hr*hr<k&&(I||(I=[]),I.push({x:tr.x,y:tr.y,z:tr.z}))}}}}}}}if(I){for(var lr={},fr=[],ur=0;ur<I.length;ur++){var xr=a(I[ur]);lr[xr]||(lr[xr]=!0,fr.push(I[ur]))}b[_]=fr,w++}}if(0===w)break;for(var yr=[],cr=0;cr<r.length;cr++)if(b[cr])for(var zr=Ur(r[cr],b[cr]),gr=0;gr<zr.length;gr++)yr.push(zr[gr]);else yr.push(r[cr]);r=yr}return r}function Vr(r,e,a){void 0===e&&(e=1e-6),void 0===a&&(a=.01);for(var i=[],v=0;v<r.length;v++){var o=r[v],s=n(o);if(!(s<e)){var h=t(o.v0,o.v1),l=t(o.v1,o.v2),f=t(o.v2,o.v0),u=Math.max(h,l,f);if(u>0)if(2*s/u/u<a)continue;i.push(o)}}return i}function Pr(r,e){void 0===e&&(e=1);for(var n={},a={},o=0;o<r.length;o++)for(var s=r[o],h=[s.v0,s.v1,s.v2],l=[i(h[0]),i(h[1]),i(h[2])],f=0;f<3;f++){var u=(f+1)%3,x=v(l[f],l[u]);n[x]||(n[x]={count:0,v0:h[f],v1:h[u],k0:l[f],k1:l[u]}),n[x].count++,a[l[f]+"|"+l[u]]=!0}var y=[];for(var c in n)if(1===n[c].count){var z=n[c];a[z.k0+"|"+z.k1]?y.push({v0:z.v1,v1:z.v0,k0:z.k1,k1:z.k0}):y.push({v0:z.v0,v1:z.v1,k0:z.k0,k1:z.k1})}if(0===y.length)return[];var g=Math.max(3*e,.1),d={};function p(r){return Math.floor(r.x/g)+","+Math.floor(r.y/g)+","+Math.floor(r.z/g)}for(var M=0;M<y.length;M++)for(var m=y[M],b=0;b<2;b++){var w=0===b?m.v0:m.v1,k=p(w);d[k]||(d[k]=[]),d[k].push({edgeIdx:M,vertIdx:b,vertex:w})}for(var _={},F=[],A=0;A<y.length;A++)if(!_[A]){for(var S=y[A],I=-1,E=1/0,T=!1,q=Math.floor(S.v0.x/g),C=Math.floor(S.v0.y/g),X=Math.floor(S.v0.z/g),Y={},D=-1;D<=1;D++)for(var B=-1;B<=1;B++)for(var O=-1;O<=1;O++){var U=d[q+D+","+(C+B)+","+(X+O)];if(U)for(var Z=0;Z<U.length;Z++){var V=U[Z];V.edgeIdx===A||_[V.edgeIdx]||(Y[V.edgeIdx]=!0)}}for(var P in Y){var j=y[P],L=t(S.v0,j.v0),K=t(S.v1,j.v1),N=t(S.v0,j.v1),W=t(S.v1,j.v0),G=L+K,R=N+W;G<=R?L<=e&&K<=e&&G<E&&(I=parseInt(P),E=G,T=!1):N<=e&&W<=e&&R<E&&(I=parseInt(P),E=R,T=!0)}if(I>=0){var H=y[I];_[A]=!0,_[I]=!0;var J=T?H.v1:H.v0,Q=T?H.v0:H.v1;F.push({v0:S.v0,v1:S.v1,v2:J}),F.push({v0:S.v1,v1:Q,v2:J})}}return F}function jr(r){for(var t=[],e={},a=[],o=0;o<r.length;o++){var s=r[o];t.push(n(s));var h=i(s.v0),l=i(s.v1),f=i(s.v2);a.push([h,l,f]);for(var u=[v(h,l),v(l,f),v(f,h)],x=0;x<3;x++)e[u[x]]||(e[u[x]]=[]),e[u[x]].push(o)}var y={};for(var c in e){var z=e[c];if(!(z.length<=2))for(var g=z.slice().sort(function(r,e){return t[e]-t[r]}),d=2;d<g.length;d++)y[g[d]]=!0}for(var p={},M=0;M<r.length;M++)if(!y[M]){var m=a[M].slice().sort().join("||");p[m]?y[M]=!0:p[m]=!0}if(0===Object.keys(y).length)return r;for(var b=[],w=0;w<r.length;w++)y[w]||b.push(r[w]);return b}function Lr(r){for(var t={},e={},n=0;n<r.length;n++)for(var a=r[n],o=[a.v0,a.v1,a.v2],s=[i(o[0]),i(o[1]),i(o[2])],h=0;h<3;h++){var l=(h+1)%3,f=v(s[h],s[l]);t[f]||(t[f]={count:0,v0:o[h],v1:o[l],k0:s[h],k1:s[l]}),t[f].count++,e[s[h]+"|"+s[l]]=!0}var u=[],x=0;for(var y in t)1===t[y].count?u.push(t[y]):t[y].count>2&&x++;if(0===u.length)return{loops:[],boundaryEdgeCount:0,overSharedEdgeCount:x};for(var c={},z=0;z<u.length;z++){var g,d,p,M,m=u[z];e[m.k0+"|"+m.k1]?(g=m.k1,d=m.k0,p=m.v1,M=m.v0):(g=m.k0,d=m.k1,p=m.v0,M=m.v1),c[g]||(c[g]=[]),c[g].push({key:d,vertex:M,fromVertex:p})}var b={},w=[];for(var k in c)if(!b[k]){for(var _=[],F=k,A=u.length+1;A-- >0&&!b[F];){b[F]=!0;var S=c[F];if(!S||0===S.length)break;for(var I=null,E=0;E<S.length;E++)if(!b[S[E].key]||S[E].key===k&&_.length>2){I=S[E];break}if(!I)break;if(_.push(I.fromVertex),(F=I.key)===k)break}_.length>=3&&w.push(_)}return{loops:w,boundaryEdgeCount:u.length,overSharedEdgeCount:x}}function Kr(r,t,e,n){for(var a=!1,i=0,v=n-1;i<n;v=i++){var o=e[2*i],s=e[2*i+1],h=e[2*v],l=e[2*v+1];s>t!=l>t&&r<(h-o)*(t-s)/(l-s)+o&&(a=!a)}return a}function Nr(r){if(r.length<3)return[];if(3===r.length)return[{v0:r[0],v1:r[1],v2:r[2]}];if(4===r.length)return t(r[0],r[2])<=t(r[1],r[3])?[{v0:r[0],v1:r[1],v2:r[2]},{v0:r[0],v1:r[2],v2:r[3]}]:[{v0:r[0],v1:r[1],v2:r[3]},{v0:r[1],v1:r[2],v2:r[3]}];for(var e=0,n=0,a=0,i=0;i<r.length;i++){var v=r[i],o=r[(i+1)%r.length];e+=(v.y-o.y)*(v.z+o.z),n+=(v.z-o.z)*(v.x+o.x),a+=(v.x-o.x)*(v.y+o.y)}for(var s,h,l=0,f=0,u=0,x=0;x<r.length;x++){var y=r[x],c=r[(x+1)%r.length];l+=y.x*c.y-c.x*y.y,f+=y.x*c.z-c.x*y.z,u+=y.y*c.z-c.y*y.z}l=Math.abs(l),f=Math.abs(f),u=Math.abs(u),l>=f&&l>=u?(s=function(r){return r.x},h=function(r){return r.y}):f>=u?(s=function(r){return r.x},h=function(r){return r.z}):(s=function(r){return r.y},h=function(r){return r.z});for(var z,g,d=r.length,p=new Float64Array(2*d),M=0;M<d;M++)p[2*M]=s(r[M]),p[2*M+1]=h(r[M]);try{z=new xr(p),g=new _r(z);for(var m=0;m<d;m++){var b=(m+1)%d;try{g.constrainOne(m,b)}catch(r){}}}catch(r){try{z=new xr(p)}catch(r){return[]}}for(var w=[],k=z.triangles,_=0;_<k.length;_+=3){var F=k[_],A=k[_+1],S=k[_+2];Kr((p[2*F]+p[2*A]+p[2*S])/3,(p[2*F+1]+p[2*A+1]+p[2*S+1])/3,p,d)&&w.push({v0:r[F],v1:r[A],v2:r[S]})}var I=Math.sqrt(e*e+n*n+a*a);if(I>1e-12)for(var E=e/I,T=n/I,q=a/I,C=0;C<w.length;C++){var X=w[C],Y=X.v1.x-X.v0.x,D=X.v1.y-X.v0.y,B=X.v1.z-X.v0.z,O=X.v2.x-X.v0.x,U=X.v2.y-X.v0.y,Z=X.v2.z-X.v0.z;if((D*Z-B*U)*E+(B*O-Y*Z)*T+(Y*U-D*O)*q<0){var V=X.v1;X.v1=X.v2,X.v2=V}}return w}function Wr(r,t,e){e||(e=3);for(var n=0;n<e;n++){if(o(r).overShared>0)r=Dr(Yr(r=jr(r),t).triangles);var a=Lr(r);if(0===a.loops.length)break;for(var i=0,v=0;v<a.loops.length;v++){var s=a.loops[v];if(!(s.length<3)&&!(s.length>500)){var h=Nr(s);if(0!==h.length){for(var l=0;l<h.length;l++)r.push(h[l]);if(i+=h.length,o(r=Dr(Yr(r,t).triangles)).overShared>0)r=Dr(Yr(r=jr(r),t).triangles)}}}if(0===i)break}return r}function Gr(r,t){for(var e={},n=0;n<r.length;n++){e[r[n].x+","+r[n].y+","+r[n].z]=n}for(var a=[],i=0;i<t.length;i++){var v=t[i].vertices,o=e[v[0].x+","+v[0].y+","+v[0].z],s=e[v[1].x+","+v[1].y+","+v[1].z],h=e[v[2].x+","+v[2].y+","+v[2].z];void 0!==o&&void 0!==s&&void 0!==h&&a.push([o,s,h])}for(var l={},f=0;f<r.length;f++){var u=r[f],x=Math.floor(u.x/2)+","+Math.floor(u.y/2)+","+Math.floor(u.z/2);l[x]||(l[x]=[]),l[x].push(f)}for(var y=0;y<30;y++){for(var c={},z=0;z<a.length;z++)for(var g=a[z],d=0;d<3;d++){var p=g[d],M=g[(d+1)%3],m=p<M?p+"|"+M:M+"|"+p;c[m]=(c[m]||0)+1}var b=[];for(var w in c)if(1===c[w]){var k=w.split("|");b.push([parseInt(k[0]),parseInt(k[1])])}if(0===b.length)break;for(var _=[],F={},A=0;A<b.length;A++){var S=b[A],I=S[0]<S[1]?S[0]+"|"+S[1]:S[1]+"|"+S[0];if(!F[I]){for(var E=r[S[0]],T=r[S[1]],q={x:(E.x+T.x)/2,y:(E.y+T.y)/2,z:(E.z+T.z)/2},C=Math.floor(q.x/2),X=Math.floor(q.y/2),Y=Math.floor(q.z/2),D=-1,B=1/0,O=-1;O<=1;O++)for(var U=-1;U<=1;U++)for(var Z=-1;Z<=1;Z++){var V=l[C+O+","+(X+U)+","+(Y+Z)];if(V)for(var P=0;P<V.length;P++){var j=V[P];if(j!==S[0]&&j!==S[1]){var L=r[j],K=q.x-L.x,N=q.y-L.y,W=q.z-L.z,G=K*K+N*N+W*W;if(!(G>=B)){var R=S[0]<j?S[0]+"|"+j:j+"|"+S[0],H=S[1]<j?S[1]+"|"+j:j+"|"+S[1];if(!((c[R]||0)>=2||(c[H]||0)>=2)){var J=T.x-E.x,Q=T.y-E.y,$=T.z-E.z,rr=L.x-E.x,tr=L.y-E.y,er=L.z-E.z,nr=Q*er-$*tr,ar=$*rr-J*er,ir=J*tr-Q*rr;nr*nr+ar*ar+ir*ir<1e-12||(D=j,B=G)}}}}}if(D>=0){a.push([S[0],S[1],D]),_.push([S[0],S[1],D]),F[I]=!0;var vr=S[0]<D?S[0]+"|"+D:D+"|"+S[0],or=S[1]<D?S[1]+"|"+D:D+"|"+S[1];c[vr]=(c[vr]||0)+1,c[or]=(c[or]||0)+1,c[I]=2}}}if(0===_.length)break;_.length}for(var sr=[],hr=0;hr<a.length;hr++){var lr=a[hr];sr.push({vertices:[{x:r[lr[0]].x,y:r[lr[0]].y,z:r[lr[0]].z},{x:r[lr[1]].x,y:r[lr[1]].y,z:r[lr[1]].z},{x:r[lr[2]].x,y:r[lr[2]].y,z:r[lr[2]].z}]})}return{points:r,triangles:sr}}r.bboxOverlap=function(r,t){return r.minX<=t.maxX&&r.maxX>=t.minX&&r.minY<=t.maxY&&r.maxY>=t.minY&&r.minZ<=t.maxZ&&r.maxZ>=t.minZ},r.boolean=function(r,t,e){if(!r||!t||0===r.length||0===t.length)return null;var n=d(r,t);if(0===n.length){var a;if("union"===e)a=r.concat(t);else{if("intersect"===e)return null;a=r.slice()}var i=Yr(a,0);return{soup:a,points:i.points,triangles:i.triangles}}for(var v={},o={},s=0;s<n.length;s++){var h=n[s];v[h.idxA]||(v[h.idxA]=[]),v[h.idxA].push(h),o[h.idxB]||(o[h.idxB]=[]),o[h.idxB].push(h)}var l=g(r),f=g(t),x=Math.max(2*l,.1),c=Math.max(2*f,.1),z={xy:{grid:y(r,x),cellSize:x},yz:{grid:u(r,x,function(r){return r.y},function(r){return r.z}),cellSize:x},xz:{grid:u(r,x,function(r){return r.x},function(r){return r.z}),cellSize:x}},p={xy:{grid:y(t,c),cellSize:c},yz:{grid:u(t,c,function(r){return r.y},function(r){return r.z}),cellSize:c},xz:{grid:u(t,c,function(r){return r.x},function(r){return r.z}),cellSize:c}},M=qr(r,v,t,p),m=qr(t,o,r,z),b=Cr(r,M,v,t,p),w=Cr(t,m,o,r,z);b.inside.length>0&&(b.inside=Xr(b.inside,1e-4)),b.outside.length>0&&(b.outside=Xr(b.outside,1e-4)),w.inside.length>0&&(w.inside=Xr(w.inside,1e-4)),w.outside.length>0&&(w.outside=Xr(w.outside,1e-4)),b.inside.length>0&&(b.inside=Or(b.inside)),b.outside.length>0&&(b.outside=Or(b.outside)),w.inside.length>0&&(w.inside=Or(w.inside)),w.outside.length>0&&(w.outside=Or(w.outside));var k=[];if("subtract"===e){for(var _=0;_<b.outside.length;_++)k.push(b.outside[_]);for(var F=function(r){for(var t=[],e=0;e<r.length;e++){var n=r[e];t.push({v0:{x:n.v0.x,y:n.v0.y,z:n.v0.z},v1:{x:n.v2.x,y:n.v2.y,z:n.v2.z},v2:{x:n.v1.x,y:n.v1.y,z:n.v1.z}})}return t}(w.inside),A=0;A<F.length;A++)k.push(F[A])}else if("union"===e){for(var S=0;S<b.outside.length;S++)k.push(b.outside[S]);for(var I=0;I<w.outside.length;I++)k.push(w.outside[I])}else{if("intersect"!==e)return null;for(var E=0;E<b.inside.length;E++)k.push(b.inside[E]);for(var T=0;T<w.inside.length;T++)k.push(w.inside[T])}if(0===k.length)return null;var q=Yr(k,1e-4);return{soup:k,points:q.points,triangles:q.triangles}},r.buildCurtainAndCap=function(r,t){var e=Lr(r);if(0===e.loops.length)return[];for(var n=1/0,a=0;a<r.length;a++){var i=r[a];i.v0.z<n&&(n=i.v0.z),i.v1.z<n&&(n=i.v1.z),i.v2.z<n&&(n=i.v2.z)}for(var v=n-(t||10),o=[],s=0;s<e.loops.length;s++){for(var h=e.loops[s],l=[],f=0;f<h.length;f++){var u=h[f],x=h[(f+1)%h.length],y={x:u.x,y:u.y,z:v},c={x:x.x,y:x.y,z:v};o.push({v0:u,v1:x,v2:c}),o.push({v0:u,v1:c,v2:y}),l.push(y)}for(var z=Nr(l),g=0;g<z.length;g++)o.push({v0:z[g].v2,v1:z[g].v1,v2:z[g].v0})}return o},r.buildSpatialGrid=y,r.buildSpatialGridOnAxes=u,r.capBoundaryLoops=function(r){var t=Lr(r);if(0===t.loops.length)return[];for(var e=[],n=0;n<t.loops.length;n++)for(var a=Nr(t.loops[n]),i=0;i<a.length;i++)e.push(a[i]);return e},r.capBoundaryLoopsSequential=Wr,r.chainSegments=function(r,t){if(0===r.length)return[];var n=2*t,a={};function i(r){return Math.floor(r.x/n)+","+Math.floor(r.y/n)+","+Math.floor(r.z/n)}for(var v=0;v<r.length;v++)for(var o=[r[v].p0,r[v].p1],s=0;s<2;s++){var h=i(o[s]);a[h]||(a[h]=[]),a[h].push({segIdx:v,endIdx:s})}for(var l=t*t,f=new Array(r.length),u=0;u<f.length;u++)f[u]=!1;function x(t,i){for(var v=function(r){for(var t=Math.floor(r.x/n),e=Math.floor(r.y/n),a=Math.floor(r.z/n),i=[],v=-1;v<=1;v++)for(var o=-1;o<=1;o++)for(var s=-1;s<=1;s++)i.push(t+v+","+(e+o)+","+(a+s));return i}(t),o=l,s=-1,h=-1,u=0;u<v.length;u++){var x=a[v[u]];if(x)for(var y=0;y<x.length;y++){var c=x[y];if(!f[c.segIdx]&&c.segIdx!==i){var z=e(t,0===c.endIdx?r[c.segIdx].p0:r[c.segIdx].p1);z<o&&(o=z,s=c.segIdx,h=c.endIdx)}}}return s>=0?{segIdx:s,endIdx:h}:null}for(var y=[],c=0;c<r.length;c++)if(!f[c]){f[c]=!0;for(var z=[r[c].p0,r[c].p1],g=[],d=!0;d;){d=!1;var p=x(z[z.length-1],-1);if(p){f[p.segIdx]=!0;var M=r[p.segIdx];0===p.endIdx?z.push(M.p1):z.push(M.p0),d=!0}}for(d=!0;d;){d=!1;var m=x(g.length>0?g[g.length-1]:z[0],-1);if(m){f[m.segIdx]=!0;var b=r[m.segIdx];0===m.endIdx?g.push(b.p1):g.push(b.p0),d=!0}}if(g.length>0){g.reverse();var w=g.concat(z);y.push(w)}else y.push(z)}return y},r.classifyByFloodFill=qr,r.classifyNormalDirection=function(r,t,e){if(0===r.length)return"N/A";for(var n=0,a=0,i=0,v=0,o=0;o<r.length;o++){var s=r[o].v0,h=r[o].v1,l=r[o].v2,f=h.x-s.x,u=h.y-s.y,x=h.z-s.z,y=l.x-s.x,c=l.y-s.y,z=l.z-s.z,g=u*z-x*c,d=x*y-f*z,p=f*c-u*y,M=.5*Math.sqrt(g*g+d*d+p*p);M<1e-12||(n+=.5*g,a+=.5*d,i+=.5*p,v+=M)}if(v<1e-12)return"N/A";if(t){if(e>1e-6)return"Out";if(e<-1e-6)return"In"}var m=Math.sqrt(n*n+a*a+i*i),b=m/v;if(b<.15)return e>1e-6?t?"Out":"~Out":e<-1e-6?t?"In":"~In":"Chaos";var w=n/m,k=a/m,_=i/m,F=Math.abs(w),A=Math.abs(k),S=Math.abs(_);return S>.7&&S>=F&&S>=A?_>0?"Z+":"Z-":F>.7&&F>=A&&F>=S?w>0?"X+":"X-":A>.7&&A>=F&&A>=S?k>0?"Y+":"Y-":b>.5?"Aligned":"Chaos"},r.classifyPointMultiAxis=Tr,r.cleanCrossingTriangles=jr,r.compute3DSurfaceArea=function(r){for(var t=0,e=0;e<r.length;e++){var n=r[e].v0,a=r[e].v1,i=r[e].v2,v=a.x-n.x,o=a.y-n.y,s=a.z-n.z,h=i.x-n.x,l=i.y-n.y,f=i.z-n.z,u=o*f-s*l,x=s*h-v*f,y=v*l-o*h;t+=.5*Math.sqrt(u*u+x*x+y*y)}return t},r.computeBBox=function(r){for(var t=1/0,e=1/0,n=1/0,a=-1/0,i=-1/0,v=-1/0,o=0;o<r.length;o++)for(var s=r[o],h=[s.v0,s.v1,s.v2],l=0;l<3;l++){var f=h[l];f.x<t&&(t=f.x),f.y<e&&(e=f.y),f.z<n&&(n=f.z),f.x>a&&(a=f.x),f.y>i&&(i=f.y),f.z>v&&(v=f.z)}return{minX:t,minY:e,minZ:n,maxX:a,maxY:i,maxZ:v}},r.computeBounds=function(r){for(var t=1/0,e=1/0,n=1/0,a=-1/0,i=-1/0,v=-1/0,o=0;o<r.length;o++){var s=r[o];s.x<t&&(t=s.x),s.y<e&&(e=s.y),s.z<n&&(n=s.z),s.x>a&&(a=s.x),s.y>i&&(i=s.y),s.z>v&&(v=s.z)}return{minX:t,maxX:a,minY:e,maxY:i,minZ:n,maxZ:v}},r.computeProjectedArea=function(r,t){for(var e=0,n=0;n<r.length;n++){var a=r[n].v0,i=r[n].v1,v=r[n].v2,o=s(r[n]);if("xy"===t){if(o.z<=0)continue;var h=(i.x-a.x)*(v.y-a.y)-(v.x-a.x)*(i.y-a.y);e+=Math.abs(h)/2}else if("yz"===t){if(o.x<=0)continue;var l=(i.y-a.y)*(v.z-a.z)-(v.y-a.y)*(i.z-a.z);e+=Math.abs(l)/2}else if("xz"===t){if(o.y<=0)continue;var f=(i.x-a.x)*(v.z-a.z)-(v.x-a.x)*(i.z-a.z);e+=Math.abs(f)/2}}return e},r.computeSignedVolume=function(r){if(0===r.length)return 0;for(var t=0,e=0,n=0,a=r.length,i=0;i<a;i++)t+=r[i].v0.x+r[i].v1.x+r[i].v2.x,e+=r[i].v0.y+r[i].v1.y+r[i].v2.y,n+=r[i].v0.z+r[i].v1.z+r[i].v2.z;var v=1/(3*a);t*=v,e*=v,n*=v;for(var o=0,s=0;s<a;s++){var h=r[s].v0.x-t,l=r[s].v0.y-e,f=r[s].v0.z-n,u=r[s].v1.x-t,x=r[s].v1.y-e,y=r[s].v1.z-n,c=r[s].v2.x-t,z=r[s].v2.y-e,g=r[s].v2.z-n;o+=(h*(x*g-z*y)-u*(l*g-z*f)+c*(l*y-x*f))/6}return o},r.countOpenEdges=o,r.cross=a,r.deduplicateSeamVertices=Xr,r.dist3=t,r.distSq3=e,r.edgeKey=v,r.ensureZUpNormals=Br,r.estimateAvgEdge=g,r.extractBoundaryLoops=Lr,r.flipAllNormals=function(r){for(var t=[],e=0;e<r.length;e++){var n=r[e];t.push({v0:{x:n.v0.x,y:n.v0.y,z:n.v0.z},v1:{x:n.v2.x,y:n.v2.y,z:n.v2.z},v2:{x:n.v1.x,y:n.v1.y,z:n.v1.z}})}return t},r.forceCloseIndexedMesh=Gr,r.generateClosingTriangles=function(r,t){function e(r,t){var e=r.x-t.x,n=r.y-t.y,a=r.z-t.z;return e*e+n*n+a*a}function n(r,t,e){var n=t.x-r.x,a=t.y-r.y,i=t.z-r.z,v=e.x-r.x,o=e.y-r.y,s=e.z-r.z,h=a*s-i*o,l=i*v-n*s,f=n*o-a*v;return.5*Math.sqrt(h*h+l*l+f*f)}for(var a=t*t,o=0;o<20;o++){for(var s={},h={},l=0;l<r.length;l++)for(var f=r[l],u=[f.v0,f.v1,f.v2],x=[i(u[0]),i(u[1]),i(u[2])],y=0;y<3;y++){h[x[y]]=u[y];var c=v(x[y],x[(y+1)%3]);s[c]=(s[c]||0)+1}var z=[];for(var g in s)if(1===s[g]){var d=g.split("|");z.push({k0:d[0],k1:d[1]})}if(0===z.length)return r;for(var p=Math.max(t,1),M={},m=Object.keys(h),b=0;b<m.length;b++){var w=h[m[b]],k=Math.floor(w.x/p)+","+Math.floor(w.y/p)+","+Math.floor(w.z/p);M[k]||(M[k]=[]),M[k].push(m[b])}for(var _=[],F={},A=0;A<z.length;A++){var S=z[A],I=v(S.k0,S.k1);if(!F[I]){for(var E=h[S.k0],T=h[S.k1],q={x:(E.x+T.x)/2,y:(E.y+T.y)/2,z:(E.z+T.z)/2},C=null,X=1/0,Y=Math.floor(q.x/p),D=Math.floor(q.y/p),B=Math.floor(q.z/p),O=-1;O<=1;O++)for(var U=-1;U<=1;U++)for(var Z=-1;Z<=1;Z++){var V=M[Y+O+","+(D+U)+","+(B+Z)];if(V)for(var P=0;P<V.length;P++){var j=V[P];if(j!==S.k0&&j!==S.k1){var L=h[j],K=e(q,L);if(!(K>a||K>=X)){var N=v(S.k0,j),W=v(S.k1,j),G=s[N]||0,R=s[W]||0;if(!(G>=2||R>=2))n(E,T,L)<1e-6||(C=j,X=K)}}}}if(null!==C){var H=h[C];_.push({v0:E,v1:T,v2:H}),F[I]=!0;var J=v(S.k0,C),Q=v(S.k1,C);s[J]=(s[J]||0)+1,s[Q]=(s[Q]||0)+1,s[I]=2}}}if(0===_.length)return r;for(var $=0;$<_.length;$++)r.push(_[$]);_.length}return r},r.intersectMeshPair=function(r,t){for(var e=[],n=g(t),a=Math.max(2*n,.1),i=y(t,a),v=0;v<r.length;v++)for(var o=r[v],s=c(i,z(o),a),l=0;l<s.length;l++){var f=h(o,t[s[l]]);f&&e.push(f)}return e},r.intersectMeshPairTagged=d,r.lerpVert=function(r,t,e){return{x:r.x+e*(t.x-r.x),y:r.y+e*(t.y-r.y),z:r.z+e*(t.z-r.z)}},r.queryGrid=c,r.queryGridOnAxes=x,r.removeDegenerateTriangles=Vr,r.removeOverlappingTriangles=function(r,e){void 0===e&&(e=.5);for(var n=[],a=[],i=[],v=0;v<r.length;v++){var o=r[v];n.push({x:(o.v0.x+o.v1.x+o.v2.x)/3,y:(o.v0.y+o.v1.y+o.v2.y)/3,z:(o.v0.z+o.v1.z+o.v2.z)/3});var s=o.v1.x-o.v0.x,h=o.v1.y-o.v0.y,l=o.v1.z-o.v0.z,f=o.v2.x-o.v0.x,u=o.v2.y-o.v0.y,x=o.v2.z-o.v0.z,y=h*x-l*u,c=l*f-s*x,z=s*u-h*f,g=Math.sqrt(y*y+c*c+z*z);g>0&&(y/=g,c/=g,z/=g),a.push({x:y,y:c,z:z}),i.push(.5*g)}var d=Math.max(2*e,.1),p={};function M(r){return Math.floor(r.x/d)+","+Math.floor(r.y/d)+","+Math.floor(r.z/d)}for(var m=0;m<r.length;m++){var b=M(n[m]);p[b]||(p[b]=[]),p[b].push(m)}for(var w={},k=0;k<r.length;k++)if(!w[k])for(var _=n[k],F=Math.floor(_.x/d),A=Math.floor(_.y/d),S=Math.floor(_.z/d),I=-1;I<=1;I++)for(var E=-1;E<=1;E++)for(var T=-1;T<=1;T++){var q=p[F+I+","+(A+E)+","+(S+T)];if(q)for(var C=0;C<q.length;C++){var X=q[C];if(!(X<=k||w[X]))if(!(t(_,n[X])>e))if(!(Math.min(i[k],i[X])/Math.max(i[k],i[X])<.3)){var Y=a[k].x*a[X].x+a[k].y*a[X].y+a[k].z*a[X].z;(Y<-.5||Y>.5)&&(i[k]<=i[X]?w[k]=!0:w[X]=!0)}}}if(0===Object.keys(w).length)return r;for(var D=[],B=0;B<r.length;B++)w[B]||D.push(r[B]);return D},r.repairMesh=async function(r,t,e){t||(t={});var n=t.closeMode||"none",a=t.snapTolerance||0,i=t.stitchTolerance||1,v=!1!==t.removeDegenerate;function s(r){"function"==typeof e&&e(r)}function h(){return new Promise(function(r){setTimeout(r,0)})}if(s("Deduplicating vertices..."),await h(),r=Xr(r,1e-4),s("Resolving T-junctions..."),await h(),r=Zr(r,1e-4),s("Welding vertices..."),await h(),r=Dr(Yr(r,a).triangles),v&&(s("Removing degenerate triangles..."),await h(),r=Vr(r,1e-6,.01)),"stitch"===n){s("Stitching boundaries..."),await h();var l=Pr(r,i);if(l.length>0)for(var f=0;f<l.length;f++)r.push(l[f]);var u=Yr(r,a),x=u.points,y=u.triangles;s("Capping boundary loops..."),await h();var c=Dr(y),z=Yr(c=Wr(c,a,3),a);x=z.points,y=z.triangles,s("Cleaning up post-cap mesh..."),await h();var g=Dr(y),d=!1;if(o(g).overShared>0&&(g=jr(g),d=!0),v){var p=g.length;(g=Vr(g,1e-6,.01)).length<p&&(d=!0)}if(d){var M=Yr(g,a);x=M.points,y=M.triangles}if(s("Force-closing gaps..."),await h(),o(Dr(y)).openEdges>0){var m=Gr(x,y);x=m.points,y=m.triangles}return r=Dr(y),s("Repair complete."),{points:x,triangles:y,soup:r}}var b=Yr(r,a);return s("Repair complete."),{points:b.points,triangles:b.triangles,soup:r}},r.resolveTJunctions=Zr,r.retriangulateWithSteinerPoints=Ar,r.simplifyPolyline=function(r,e){if(r.length<=2||e<=0)return r;for(var n=[r[0]],a=0,i=1;i<r.length-1;i++)(a+=t(r[i-1],r[i]))>=e&&(n.push(r[i]),a=0);return n.push(r[r.length-1]),n},r.stitchByProximity=Pr,r.triBBox=z,r.triNormal=s,r.triTriIntersection=h,r.triTriIntersectionDetailed=function(r,t){var e=s(t),n=-(e.x*t.v0.x+e.y*t.v0.y+e.z*t.v0.z),i=e.x*r.v0.x+e.y*r.v0.y+e.z*r.v0.z+n,v=e.x*r.v1.x+e.y*r.v1.y+e.z*r.v1.z+n,o=e.x*r.v2.x+e.y*r.v2.y+e.z*r.v2.z+n;if(i>0&&v>0&&o>0)return null;if(i<0&&v<0&&o<0)return null;var h=s(r),u=-(h.x*r.v0.x+h.y*r.v0.y+h.z*r.v0.z),x=h.x*t.v0.x+h.y*t.v0.y+h.z*t.v0.z+u,y=h.x*t.v1.x+h.y*t.v1.y+h.z*t.v1.z+u,c=h.x*t.v2.x+h.y*t.v2.y+h.z*t.v2.z+u;if(x>0&&y>0&&c>0)return null;if(x<0&&y<0&&c<0)return null;var z=h.x*e.x+h.y*e.y+h.z*e.z;if(Math.abs(z)>.9999)return null;var g=a(h,e),d=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);if(d<1e-12)return null;g.x/=d,g.y/=d,g.z/=d;var p=f(h,u,e,n,g);if(!p)return null;var M=l(r,g,p,i,v,o);if(!M)return null;var m=l(t,g,p,x,y,c);if(!m)return null;var b=Math.max(M.min,m.min),w=Math.min(M.max,m.max);if(b>=w-1e-10)return null;var k=w-b;return k<1e-8?null:{dA:[i,v,o],dB:[x,y,c],segLen:k}},r.triangleArea3D=n,r.triangulateLoop=Nr,r.vKey=i,r.weldBoundaryVertices=function(r,t){if(t<=0)return r;for(var e={},n=0;n<r.length;n++)for(var a=r[n],o=[a.v0,a.v1,a.v2],s=[i(o[0]),i(o[1]),i(o[2])],h=0;h<3;h++){var l=(h+1)%3,f=v(s[h],s[l]);e[f]||(e[f]={count:0,k0:s[h],k1:s[l],v0:o[h],v1:o[l]}),e[f].count++}var u={};for(var x in e)1===e[x].count&&(u[e[x].k0]=e[x].v0,u[e[x].k1]=e[x].v1);var y=Object.keys(u);if(0===y.length)return r;for(var c=Math.max(2*t,.01),z={},g=t*t,d=0;d<y.length;d++){var p=u[y[d]],M=Math.floor(p.x/c)+","+Math.floor(p.y/c)+","+Math.floor(p.z/c);z[M]||(z[M]=[]),z[M].push(y[d])}for(var m={},b=0;b<y.length;b++)m[y[b]]=y[b];function w(r){for(;m[r]!==r;)m[r]=m[m[r]],r=m[r];return r}function k(r,t){var e=w(r),n=w(t);e!==n&&(m[e]=n)}for(var _=0;_<y.length;_++)for(var F=u[y[_]],A=Math.floor(F.x/c),S=Math.floor(F.y/c),I=Math.floor(F.z/c),E=-1;E<=1;E++)for(var T=-1;T<=1;T++)for(var q=-1;q<=1;q++){var C=z[A+E+","+(S+T)+","+(I+q)];if(C)for(var X=0;X<C.length;X++)if(C[X]!==y[_]){var Y=u[C[X]],D=F.x-Y.x,B=F.y-Y.y,O=F.z-Y.z;D*D+B*B+O*O<=g&&k(y[_],C[X])}}for(var U={},Z=0;Z<y.length;Z++){var V=w(y[Z]),P=u[y[Z]];U[V]||(U[V]={sumX:0,sumY:0,sumZ:0,count:0}),U[V].sumX+=P.x,U[V].sumY+=P.y,U[V].sumZ+=P.z,U[V].count++}for(var j={},L=0,K=0;K<y.length;K++){var N=U[w(y[K])];N.count>1&&(j[y[K]]={x:N.sumX/N.count,y:N.sumY/N.count,z:N.sumZ/N.count},L++)}if(0===L)return r;function W(r){var t=i(r);return j[t]?j[t]:r}for(var G=[],R=0;R<r.length;R++){var H=W(r[R].v0),J=W(r[R].v1),Q=W(r[R].v2),$=i(H),rr=i(J),tr=i(Q);$!==rr&&rr!==tr&&$!==tr&&G.push({v0:H,v1:J,v2:Q})}return G},r.weldVertices=Yr,r.weldedToSoup=Dr});
//# sourceMappingURL=trimesh-boolean.min.js.map
